<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>JS13kgames 2020 - 404</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>*{margin:0;padding:0}:root{--scroll-distance:1.5em}html{scroll-padding-top:var(--scroll-distance)}body{color:#000;background-color:#fff;scroll-padding-top:var(--scroll-distance)}#app{display:flex;align-items:center}#app.right-handedness{flow-direction:row}#app-left-handedness{flow-direction:row-reverse}.nav-list{display:flex;flex-wrap:wrap;list-style:none;align-items:center}.nav-list__item{flex:1;margin:.5em;text-align:center}.tab-view:not(:target){display:none}svg{flex-shrink:0;display:block;height:98vmin;width:98vmin;margin-left:auto;margin-right:auto;margin-inline-start:auto;margin-inline-end:auto}.hidden.world{display:none}.background,.foreground,.middleground{fill:hsl(var(--hue),var(--saturation),var(--luminance))}.five-portal,.four-portal,.six-portal,.three-portal{fill:transparent;stroke-width:var(--strokeWidth);stroke:hsl(var(--hue),var(--saturation),var(--luminance))}.sun{fill:gold}.speaker-box,.textbox{fill:hsl(var(--hue),var(--saturation),var(--luminance));stroke:#000;stroke-width:var(--strokeWidth)}.speaker-box__text,.textbox__text{fill:#fff;font-family:var(--fontFamily)}.speaker-box__text,.textbox__text,.time{font-size:.2em}.speaker-avatar__pic--narrator{stroke:hsl(var(--hue),var(--saturation),var(--luminance))}</style></head>
<body>
<noscript>
I'm deeply sorry, but this game requires JavaScript to run.
</noscript>
<main id="app"></main>
<script>/**
 * This file is part of JS13kGames - 404.
 * An Offline Life is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * An Offline Life is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with An Offline Life.  If not, see <https://www.gnu.org/licenses/>.
 */

!function(){"use strict";var t="game:time:update",e="game:controls:turn",o="world:weather:wind",n="game:world:switch",i={c:130.81,d:146.83,e:164.81,f:174.61,g:196,a:220,h:246.91,C:261.63,D:293.66,E:329.63,F:349.23,G:392,A:440,H:493.88,B:523.25},r="fantasy",h="serif",p=function(t){function e(e){t.call(this,e),this._mount(e.parent)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._createHtmlElement=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=[]);var n=document.createElement(t);return Object.keys(e).forEach((function(t){var o=e[t];n.setAttribute(t,o)})),o.forEach((function(t){n.classList.add(t)})),n},e.prototype._createSvgElement=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=[]);var n=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach((function(t){var o=e[t];n.setAttributeNS(null,t,o)})),o.forEach((function(t){n.classList.add(t)})),n},e.prototype._mount=function(t){throw new Error("Requires implementation")},e}(function(t){function e(e){t.call(this,e),this._sympathy=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mapSympathyToLuminance=function(){return 50+this._sympathy/2},e.prototype._updateView=function(){if(t.prototype._updateView.call(this),!this.element)throw new Error("Requires Element");var e=this._mapSympathyToLuminance();this.element.style.setProperty("--luminance",e+"%","")},e}(function(t){function e(e){t.call(this,e),this._life=100}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._updateView=function(){if(!this.element)throw new Error("Requires Element");this.element.style.setProperty("--saturation",this._life+"%","")},e}(function(t){function e(e){var o=this;t.call(this,e),this._eventNode=e.eventNode,Object.keys(this._getEventMap()).forEach((function(t){o._eventNode.addEventListener(t,o,!1)}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleEvent=function(t){var e=t.detail,o=t.isTrusted,n=t.target,i=t.type,r=this._getEventMap()[i];if(r)return o&&n?void r(n):!o&&e?void r(e):(console.warn("Unknown event type "+i),void r(t));console.warn("No callback for "+t.type)},e.prototype._getEventMap=function(){return{}},e}((function(t){var e=t.boundingBox,o=e.x,n=e.y,i=e.height,r=e.width;this._boundingBox={x:o,y:n,h:i,w:r}}))))),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("svg",{viewBox:o+" "+n+" "+r+" "+i},[]),this.element.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.appendChild(this.element)},e}(p),s=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){return{click:this.__handleClick.bind(this)}},o.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["controls"]),t.appendChild(this.element),this.__mountLeft(),this.__mountTop(),this.__mountRight()},o.prototype.__handleClick=function(t){var o=t.classList.contains("left"),n=t.classList.contains("right"),i=t.classList.contains("top");if(o){var r=new CustomEvent(e,{detail:{direction:"left"}});this._eventNode.dispatchEvent(r)}if(n){var h=new CustomEvent(e,{detail:{direction:"right"}});this._eventNode.dispatchEvent(h)}if(i){var p=new CustomEvent(e,{detail:{direction:"top"}});this._eventNode.dispatchEvent(p)}},o.prototype.__mountLeft=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=o+n/2,r=o+n,h=e+t.w/3,p=[h+","+i,h+","+r,e+","+(i+r)/2].join(" "),a=this._createSvgElement("polygon",{points:p},["left","control"]);this.element.appendChild(a)},o.prototype.__mountRight=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=o+n/2,h=o+n,p=e+2*i/3,a=[p+","+r,p+","+h,e+i+","+(r+h)/2].join(" "),s=this._createSvgElement("polygon",{points:a},["right","control"]);this.element.appendChild(s)},o.prototype.__mountTop=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=o+n/2,h=e+i/3,p=e+2*i/3,a=[p+","+r,h+","+r,(p+h)/2+","+o].join(" "),s=this._createSvgElement("polygon",{points:a},["top","control"]);this.element.appendChild(s)},o}(p),d=function(e){function o(t){e.call(this,t),this.clock={hour:0,minute:0}}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this._handleGameTimeUpdate.bind(this),e},o.prototype._handleGameTimeUpdate=function(t){if(t.hour&&t.minute){var e=t.hour,o=("00"+t.minute).slice(-2);this.clock={hour:e,minute:o},this._updateView()}else console.warn("Invalid event",t)},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y;this.element=this._createSvgElement("text",{x:o,y:n},["time"]);var i=document.createTextNode("");this.element.appendChild(i),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this);var t=this.clock,o=t.hour,n=t.minute;this.element.textContent=o+":"+n},o}(p),u={DEBUG:"Debug",DEBUG_BUTTON:"Start time",INVENTORY:"Inventory",LANGUAGE:"Language",LANGUAGE_EN:"English",MEMORY:"Memory",NO_ITEMS:"No items.",NO_MEMORIES:"Make some encounters.",SETTINGS:"Settings",TYPING:"Typing speed",WELCOME:"Welcome, stranger"};function l(t){return u[t]}var _=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createHtmlElement("section",{},["tab-view"]);var e=this._createHtmlElement("h2",{},["tab-view__header"]),o=document.createTextNode("");e.appendChild(o),this.element.appendChild(e);var n=document.createTextNode("");this.element.appendChild(n),t.appendChild(this.element)},e}(p),c=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-debug"),this.element.querySelector(".tab-view__header").textContent=l("DEBUG"),this._mountDebug()},e.prototype._mountDebug=function(){var t=this._createHtmlElement("button",{id:"action",type:"button"},[]);t.textContent=l("DEBUG_BUTTON"),this.element.appendChild(t)},e}(_),y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-inventory"),this.element.querySelector(".tab-view__header").textContent=l("INVENTORY"),this.__mountInventory()},e.prototype.__mountInventory=function(){var t=this._createHtmlElement("p",{},[]),e=document.createTextNode(l("NO_ITEMS"));t.appendChild(e),this.element.appendChild(t)},e}(_),m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-memory"),this.element.querySelector(".tab-view__header").textContent=l("MEMORY"),this.__mountMemory()},e.prototype.__mountMemory=function(){var t=this._createHtmlElement("p",{},[]),e=document.createTextNode(l("NO_MEMORIES"));t.appendChild(e),this.element.appendChild(t)},e}(_),g=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-settings"),this.element.querySelector(".tab-view__header").textContent=l("SETTINGS"),this.__mountForm()},e.prototype.__mountForm=function(){var t=this,e=[{value:"en",text:l("LANGUAGE_EN")}],o=this._createHtmlElement("form",{id:"form-settings",action:"#",method:"GET"},[]),n=this._createHtmlElement("fieldset",{},[]),i=this._createHtmlElement("legend",{},[]),r=document.createTextNode(l("LANGUAGE"));i.appendChild(r);var h=this._createHtmlElement("select",{name:"language"},[]),p=document.createTextNode(l("LANGUAGE"));h.appendChild(p),e.forEach((function(e){var o=t._createHtmlElement("option",{value:e.value},[]),n=document.createTextNode(e.text);o.appendChild(n),h.appendChild(o)}));var a=this._createHtmlElement("label",{},[]),s=document.createTextNode(l("TYPING"));a.appendChild(s);var d=this._createHtmlElement("input",{type:"range",min:1,max:3,step:1},[]);n.appendChild(i),n.appendChild(h),n.appendChild(a),n.appendChild(d),o.appendChild(n),this.element.appendChild(o)},e}(_),v=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createHtmlElement("section",{},[]),t.appendChild(this.element),this._mountNavigation()},e.prototype._mountNavigation=function(){var t=this,e=[{href:"#tab-inventory",text:l("INVENTORY")},{href:"#tab-memory",text:l("MEMORY")},{href:"#tab-settings",text:l("SETTINGS")},{href:"#tab-debug",text:l("DEBUG")}],o=this._createHtmlElement("nav",{},[]),n=this._createHtmlElement("ul",{},["nav-list"]);e.forEach((function(e){var o=t._createHtmlElement("li",{},["nav-list__item"]),i=t._createHtmlElement("a",{href:e.href},["nav-link"]),r=document.createTextNode(e.text);i.appendChild(r),o.appendChild(i),n.appendChild(o)})),o.appendChild(n),this.element.appendChild(o),this.__mountTabViews()},e.prototype.__mountTabViews=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},parent:this.element,eventNode:this._eventNode};this.tabs=[{id:"inventory",ref:new y(e)},{id:"memory",ref:new m(e)},{id:"settings",ref:new g(e)},{id:"debug",ref:new c(e)}]},e}(p),f=function(t){function e(e){t.call(this,e),this.name="",this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w,p=.02*r,a=this._createSvgElement("rect",{x:n+.05*h,y:i+.53*r,height:.15*r,width:.2*h},["speaker-box"]);a.style.setProperty("--strokeWidth",p+"",""),this.element.appendChild(a);var s=this._createSvgElement("text",{x:n+.07*h,y:i+.63*r},["speaker-box__text"]),d=document.createTextNode("");s.appendChild(d),this.element.appendChild(s),this.element.querySelector(".textbox__text").setAttributeNS(null,"y",i+.78*r+"")},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".speaker-box").style.setProperty("--hue",this._hue+"","");var e=this.element.querySelector(".speaker-box__text");e.style.setProperty("--fontFamily",this.style+"",""),e.textContent=this.name},e}(function(t){function e(e){t.call(this,e),this.style=h,this.text="",this._hue=42}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.showText=function(t,e){this.style=e||h,this.text=t,this._updateView()},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.02*i;this.element=this._createSvgElement("g",{},[]);var p=this._createSvgElement("rect",{x:o,y:n+.6*i,height:.5*i,width:r,rx:.02*r,ry:.02*r},["textbox"]);p.style.setProperty("--strokeWidth",h+"",""),this.element.appendChild(p);var a=this._createSvgElement("text",{x:o+.03*r,y:n+.73*i},["textbox__text"]),s=document.createTextNode("");a.appendChild(s),this.element.appendChild(a),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".textbox").style.setProperty("--hue",this._hue+"","");var e=this.element.querySelector(".textbox__text");e.style.setProperty("--fontFamily",this.style+"",""),e.textContent=this.text},e}(p)),w=function(t){function e(e){t.call(this,e),this.name="???",this.style=r,this._hue=42,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w,p=n+.1*h,a=n+.2*h,s=i+.2*r,d=i+.5*r,u=[p+","+(s+.05*r),p+.05*h+","+s,a-.05*h+","+s,a+","+(s+.05*r),p+","+(d-.05*r),p+.05*h+","+d,a-.05*h+","+d,a+","+(d-.05*r)].join(" "),l=this._createSvgElement("ellipse",{cx:n+.15*h,cy:i+.5*r,rx:.11*h,ry:.35*r},["speaker-avatar__background"]),_=this._createSvgElement("polyline",{points:u},["speaker-avatar__pic","speaker-avatar__pic--narrator"]);_.setAttributeNS(null,"stroke-linecap","round"),this.element.insertBefore(_,this.element.firstChild),this.element.insertBefore(l,this.element.firstChild)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".speaker-avatar__pic--narrator").style.setProperty("--hue",this._hue+"","")},e}(f),x=function(t){function e(e){t.call(this,e),this.melody=[],this.gain=.3,this._isActive=!1,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this._addMiddleground(),this._addForeground()},e.prototype.isActive=function(){return this._isActive},e.prototype.playMusic=function(){if(this.melody.length>0){var t=new AudioContext,e=t.createGain(),o=t.createOscillator(),n=.1;o.connect(e).connect(t.destination),o.start(n),e.gain.setValueAtTime(this.gain,n),this.melody.map((function(t){var e=t.slice(0,1);return{hz:i[e],time:.25*parseFloat(t.slice(1))}})).forEach((function(t,e){var i=t.hz,r=t.time;o.frequency.setValueAtTime(i,n),n+=r})),e.gain.setValueAtTime(0,n+.1),o.stop(n+.1)}},e.prototype.setActive=function(){this._isActive=!0,this._updateView(),this.playMusic()},e.prototype.setInactive=function(){this._isActive=!1,this._updateView()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype._mount=function(t){var e=["world","world--"+this.constructor.worldName];this.element=this._createSvgElement("g",{},e),t.appendChild(this.element)},e.prototype._rollDice=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=6),Math.floor(Math.random()*(e-t+t)+t)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.isActive()?this.element.classList.remove("hidden"):this.element.classList.add("hidden")},e}(p);x.worldName="base";var b=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addForeground(),this.__showIntro()},e.prototype._addForeground=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+.05*i,y:o+.4*n,height:.45*n,width:.9*i},eventNode:this._eventNode,parent:this.element};this._narrator=new w(r)},e.prototype.__showIntro=function(){this._narrator.showText(l("WELCOME"))},e}(x);b.worldName="intro";var E=function(e){function o(t){e.call(this,t),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this.__handleGameTimeUpdate.bind(this),e},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,p=[o+.5*r+","+(n+h),o+r-h+","+(n+.4*i),o+.7*r+","+(n+i-h),o+.3*r+","+(n+i-h),o+h+","+(n+.4*i)].join(" ");this.element=this._createSvgElement("polygon",{points:p},["five-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},o.prototype.__handleGameTimeUpdate=function(t){t.hour&&t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},o}(p),N=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new E(e)},e}(x);N.worldName="five-portal";var C=function(e){function o(t){e.call(this,t),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this.__handleGameTimeUpdate.bind(this),e},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,p=[o+.5*r+","+(n+h),o+r-h+","+(n+.5*i),o+.5*r+","+(n+i-h),o+h+","+(n+.5*i)].join(" ");this.element=this._createSvgElement("polygon",{points:p},["four-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},o.prototype.__handleGameTimeUpdate=function(t){t.hour&&t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},o}(p),B=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new C(e)},e}(x);B.worldName="four-portal";var S=function(e){function o(t){e.call(this,t),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this.__handleGameTimeUpdate.bind(this),e},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,p=[o+.3*r+","+(n+h),o+.7*r+","+(n+h),o+r-h+","+(n+.5*i),o+.7*r+","+(n+i-h),o+.3*r+","+(n+i-h),o+h+","+(n+.5*i)].join(" ");this.element=this._createSvgElement("polygon",{points:p},["six-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},o.prototype.__handleGameTimeUpdate=function(t){t.hour&&t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},o}(p),T=function(e){function o(t){e.call(this,t),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this.__handleGameTimeUpdate.bind(this),e},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,p=[o+.5*r+","+(n+h),o+r-h+","+(n+i-h),o+h+","+(n+i-h)].join(" ");this.element=this._createSvgElement("polygon",{points:p},["three-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},o.prototype.__handleGameTimeUpdate=function(t){t.hour&&t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},o}(p),k=function(t){function e(e){t.call(this,e),this.__portalLength=.3}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){this.__portalLength=.3,this.__addThreePortal(),this.__addFourPortal(),this.__addFivePortal(),this.__addSixPortal()},e.prototype._getEventMap=function(){return{click:this.__handleClick.bind(this)}},e.prototype.__addFivePortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+i*(1-this.__portalLength),y:o+n*(.5-this.__portalLength/2),height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new E(r)},e.prototype.__addFourPortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e,y:o+n*(.5-this.__portalLength/2),height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new C(r)},e.prototype.__addSixPortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+i*(.5-this.__portalLength/2),y:o+n*(1-this.__portalLength),height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new S(r)},e.prototype.__addThreePortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+i*(.5-this.__portalLength/2),y:o,height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new T(r)},e.prototype.__handleClick=function(t){var e=t.getAttribute("class");if(console.log("Clicked world",t,e),e&&(!e||e.includes("-portal"))){var o=new CustomEvent(n,{detail:{nextWorld:e}});this._eventNode.dispatchEvent(o)}},e}(x);k.worldName="portal";var j=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new S(e)},e}(x);j.worldName="six-portal";var V=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new T(e)},e}(x);V.worldName="three-portal";var O=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["guild"]),t.appendChild(this.element),this._mountMarket()},e.prototype._mountMarket=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+i,h=o+n,p=[e+","+h,e+","+(o+.1*n),e+.5*i+","+o,r+","+(o+.1*n),r+","+h].join(" "),a=this._createSvgElement("polygon",{points:p},["market"]);this.element.appendChild(a)},e}(p),M=function(e){function o(t){e.call(this,t),this._radius=3,this._axisX=this._boundingBox.x,this._axisY=this._boundingBox.y}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getElementAttributes=function(){return this._radius=this._radius||3,this._axisX=this._axisX||this._boundingBox.x,this._axisY=this._axisY||this._boundingBox.y,{r:this._radius,cx:this._axisX,cy:this._axisY}},o.prototype._getEventMap=function(){var e;return(e={})[t]=this._handleGameTimeUpdate.bind(this),e},o.prototype._handleGameTimeUpdate=function(t){var e=t.hour,o=t.minute;if(e&&o){var n=this._boundingBox,i=(n.x,n.y,n.h),r=n.w,h=-5;e>=6&&e<=18&&(h=r*(60*(e-6)+o)/720);var p=60*(e+6)+o,a=this._radius+i+i*Math.sin(p*Math.PI/720);this._axisX=h,this._axisY=a,this._updateView()}else console.warn("Invalid event",t)},o.prototype._mount=function(t){var e=this._getElementAttributes(),o=e.r,n=e.cx,i=e.cy;this.element=this._createSvgElement("circle",{r:o+"",cx:n-3*o+"",cy:i-3*o+""},["sun"]),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this);var t=this._axisX,o=this._axisY;this.element.setAttributeNS(null,"cx",t+""),this.element.setAttributeNS(null,"cy",o+"")},o}(p),G=function(t){function e(e){t.call(this,e),this.melody=["a2","a1","h1","C4","C1","D1","E1","C1","D2","h2","h2","h2","h2","h2","h1","C1","D1","h1","C2","a2","a2","a1","h1","C2","C2","C1","D1","E1","C1","D2","h2","h1","C1","D1","h1","C2","h1","a1","g1","f1","a1","g1","a4"]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this._addMiddleground(),this._addForeground(),this.__addGuild()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype.__addGuild=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+.3*i,y:o+.2*n,height:.6*n,width:.4*i},eventNode:this._eventNode,parent:this.element};new O(r)},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new M(e)},e}(x);G.worldName="five-town";var A=function(e){function o(t){e.call(this,t),this._hue=211,this._saturation=70,this._luminance=50,this._timeoutHandle=null,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this._handleGameTimeUpdate.bind(this),e},o.prototype._handleGameTimeUpdate=function(t){var e=t.hour>5&&t.hour<8;t.hour>17&&t.hour<20&&(this._luminance-=.1),e&&(this._luminance+=.1),this._updateView()},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("rect",{x:o,y:n,height:i,width:r},["background"]),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")},o}(p),L=function(e){function o(t){e.call(this,t),this._hue=140,this._life=50,this._luminance=50,this._timeoutHandle=null,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this._handleGameTimeUpdate.bind(this),e},o.prototype._handleGameTimeUpdate=function(t){var e=t.hour>5&&t.hour<8;t.hour>17&&t.hour<20&&(this._luminance-=.1),e&&(this._luminance+=.1),this._updateView()},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("rect",{x:o,y:n,height:i,width:r},["foreground"]),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")},o}(p),W=function(e){function o(t){e.call(this,t),this._hue=140,this._life=50,this._luminance=30,this._timeoutHandle=null,this._updateView()}return e&&(o.__proto__=e),o.prototype=Object.create(e&&e.prototype),o.prototype.constructor=o,o.prototype._getEventMap=function(){var e;return(e={})[t]=this._handleGameTimeUpdate.bind(this),e},o.prototype._handleGameTimeUpdate=function(t){var e=t.hour>5&&t.hour<8;t.hour>17&&t.hour<20&&(this._luminance-=.1),e&&(this._luminance+=.1),this._updateView()},o.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("rect",{x:o,y:n,height:i,width:r},["middleground"]),t.appendChild(this.element)},o.prototype._updateView=function(){e.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")},o}(p),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["castle"]),t.appendChild(this.element),this._mountLeftTower(),this._mountMain(),this._mountCrenellations(4),this._mountRightTower()},e.prototype._mountCrenellations=function(t){for(var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.7*r/(2*t+1),p=o+.15*r,a=n+.1*i,s=n+.2*i,d=[p+","+s],u=1;u<2*t;u+=2){var l=p+(u+1)*h;d.push(p+u*h+","+s),d.push(p+u*h+","+a),d.push(l+","+a),d.push(l+","+s)}var _=this._createSvgElement("polygon",{points:d.join(" ")},["crenellations"]);this.element.appendChild(_)},e.prototype._mountLeftTower=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=e+.15*t.w,r=o+n,h=[e+","+r,e+","+o,i+","+o,i+","+r].join(" "),p=this._createSvgElement("polygon",{points:h},["tower"]);this.element.appendChild(p)},e.prototype._mountMain=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+.15*i,h=e+i-.15*i,p=o+.2*n,a=o+n,s=[r+","+a,r+","+p,h+","+p,h+","+a].join(" "),d=this._createSvgElement("polygon",{points:s},[]);this.element.appendChild(d)},e.prototype._mountRightTower=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+i-.15*i,h=e+i,p=o+n,a=[r+","+p,r+","+o,h+","+o,h+","+p].join(" "),s=this._createSvgElement("polygon",{points:a},["tower"]);this.element.appendChild(s)},e}(p),F=function(t){function e(e){t.call(this,e),this.name="Leonhard",this.style=h,this._hue=80,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w,p=n+.1*h,a=n+.2*h,s=i+.2*r,d=i+.7*r,u=[p+","+d,p+.02*h+","+s,a-.02*h+","+s,a+","+d].join(" "),l=this._createSvgElement("polyline",{points:u},["speaker-avatar__pic","speaker-avatar__pic--knight"]);this.element.insertBefore(l,this.element.firstChild)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".speaker-avatar__pic--knight").style.setProperty("--hue",this._hue+"","")},e}(f),P=function(e){function n(t){e.call(this,t);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w;this._windStrength="still",this._axisX=n+.5*h,this._axisY=i+.3*r,this.degree=0,this._updateView()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype._getElementAttributes=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w;return this._axisX=this._axisX||e+.5*i,this._axisY=this._axisY||o+.5*n,this._degree=this._degree||0,{axisX:this._axisX,axisY:this._axisY,degree:this._degree}},n.prototype._getEventMap=function(){var e;return(e={})[t]=this._handleGameTimeUpdate.bind(this),e[o]=this._handleWorldWeatherWind.bind(this),e},n.prototype._handleGameTimeUpdate=function(t){if(t.hour&&t.minute){var e=1.5;"medium"===this._windStrength&&(e=6),"strong"===this._windStrength&&(e=9),this._degree=t.minute*e,this._updateView()}else console.warn("Invalid event",t)},n.prototype._handleWorldWeatherWind=function(t){this._windStrength=t.wind,this._updateView()},n.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["mill"]),t.appendChild(this.element),this._mountBuilding(),this._mountWings()},n.prototype._mountBuilding=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+.3*i,h=e+.7*i,p=o+.3*n,a=o+n,s=[r+","+a,r+.1*i+","+p,h-.1*i+","+p,h+","+a].join(" "),d=this._createSvgElement("polygon",{points:s},[]);this.element.appendChild(d)},n.prototype._mountWings=function(){var t=this._createSvgElement("g",{},["wings"]);this._mountTopWing(t),this._mountRightWing(t),this._mountBottomWing(t),this._mountLeftWing(t),this.element.appendChild(t)},n.prototype._mountBottomWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this._getElementAttributes(),r=i.axisX,h=i.axisY,p=r-.01*n,a=r+.01*n,s=h+.01*o,d=h+.3*o,u=d-.2*o,l=[a+","+s,a+","+d,p+","+d,p+","+u,a-.02*n+","+u,a-.02*n+","+s].join(" "),_=this._createSvgElement("polygon",{points:l},["bottom","wing"]);t.appendChild(_)},n.prototype._mountLeftWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this._getElementAttributes(),r=i.axisX,h=i.axisY,p=r-.3*n,a=r-.01*n,s=h-.1*o,d=h+.01*o,u=p+.2*n,l=[a+","+d,p+","+d,p+","+s,u+","+s,u+","+(d-.02*o),a+","+(d-.02*o)].join(" "),_=this._createSvgElement("polygon",{points:l},["left","wing"]);t.appendChild(_)},n.prototype._mountRightWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this._getElementAttributes(),r=i.axisX,h=i.axisY,p=r+.01*n,a=r+.3*n,s=h-.01*o,d=h+.1*o,u=a-.2*n,l=[p+","+s,a+","+s,a+","+d,u+","+d,u+","+(s+.02*o),p+","+(s+.02*o)].join(" "),_=this._createSvgElement("polygon",{points:l},["right","wing"]);t.appendChild(_)},n.prototype._mountTopWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this._getElementAttributes(),r=i.axisX,h=i.axisY,p=r-.01*n,a=r+.1*n,s=h+.3*o,d=h-.01*o,u=s+.2*o,l=[p+","+d,p+","+s,a+","+s,a+","+u,p+.02*n+","+u,p+.02*n+","+d].join(" "),_=this._createSvgElement("polygon",{points:l},["top","wing"]);t.appendChild(_)},n.prototype._updateView=function(){e.prototype._updateView.call(this);var t="rotate("+this._degree+","+(this._axisX+","+this._axisY)+")";this.element.querySelector(".wings").setAttributeNS(null,"transform",t)},n}(p),I=function(t){function e(e){t.call(this,e),this.melody=["h3","C1","D2","D2","C1","h1","C1","D1","h2","f2","h3","C1","D2","D2","C1","h1","C1","D1","h4","h1","h1","h1","h1","h1","D1","F2","F1","G1","F1","E1","D1","C1","h2","F1","F1","F2","f1","f1","f2","F1","F1","F2","f1","f1","f2","F1","F1","F2","F1","f1","f2","F4","h3","C1","D2","D2","C1","h1","C1","D1","h4"],this.__windChangeHandle=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this._addMiddleground(),this.__addMill(),this.__addCastle(),this._addForeground(),this.__addKnight(),this.fireWindChange();this.__windChangeHandle=setInterval(this.fireWindChange.bind(this),4e3)},e.prototype.fireWindChange=function(){var t=this._rollDice(),e=new CustomEvent(o,{detail:{wind:[null,"still","still","medium","medium","medium","strong"][t]}});this._eventNode.dispatchEvent(e)},e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new A(e)},e.prototype._addForeground=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=o+n/3+n/5,r={boundingBox:{x:e,y:i,height:n-i,width:t.w},eventNode:this._eventNode,parent:this.element};new L(r)},e.prototype._addMiddleground=function(){var t=this._boundingBox,e=t.x,o=(t.y,t.h),n={boundingBox:{x:e,y:o/3,height:o/5,width:t.w},eventNode:this._eventNode,parent:this.element};new W(n)},e.prototype.__addCastle=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i={boundingBox:{x:e+15,y:o+.4*n,height:n/4,width:e+.75*t.w-30},eventNode:this._eventNode,parent:this.element};new H(i)},e.prototype.__addKnight=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+.05*i,y:o+.4*n,height:.45*n,width:.9*i},eventNode:this._eventNode,parent:this.element};new F(r)},e.prototype.__addMill=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+.7*i,y:o+.3*n,height:.2*n,width:.2*i},eventNode:this._eventNode,parent:this.element};new P(r)},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new M(e)},e}(x);I.worldName="four-castle";var U=function(t){function e(e){t.call(this,e),this.melody=["H1","H1","H1","H1","B2","C1","C1","H2","G2","H2","G2","G1","G1","G1","G1","H2","H1","H1","G2","E2","G2","E2","E4","C1","D1","E1","C1","H4","H1","C1","H1","A1","G2","E2","E2","E2","E8"]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this._addMiddleground(),this._addForeground()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new M(e)},e}(x);U.worldName="six-mountain";var D=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["hut"]),t.appendChild(this.element),this._mountRoof(),this._mountBuilding()},e.prototype._mountBuilding=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=o+.8*n,h=[e+.05*i+","+r,e+.5*i+","+o,e+.95*i+","+r].join(" "),p=this._createSvgElement("polygon",{points:h},[]);this.element.appendChild(p)},e.prototype._mountRoof=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=o+.6*n,h=[e+","+r,e+.5*i+","+o,e+i+","+r].join(" "),p=this._createSvgElement("polygon",{points:h},[]);this.element.appendChild(p)},e}(p),Y=function(t){function e(e){t.call(this,e),this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["sea"]),t.appendChild(this.element),this._mountSky(),this._mountWaves()},e.prototype._mountFilter=function(){this._filterId="sea-filter";var t=document.querySelector("#"+this._filterId);if(null===t){t=this._createSvgElement("filter",{id:this._filterId},[]);var e=this._createSvgElement("feTurbulence",{id:"turbulence",type:"turbulence",baseFrequency:"0.042",numOctaves:"1",result:"turbulence",seed:5},[]),o=this._createSvgElement("animate",{id:"animate",attributeName:"baseFrequency",values:"0;0.1;0;0",from:"0",to:"100",dur:"10s",repeatCount:"inifinte"},[]),n=this._createSvgElement("feDisplacementMap",{in:"SourceGraphic",in2:"turbulence",scale:"30",xChannelSelector:"R",yChannelSelector:"R"},[]);t.appendChild(e),t.appendChild(o),this.element.appendChild(t),this.element.appendChild(n)}},e.prototype._mountSky=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=e+t.w,r=[e+","+o,i+","+o,i+","+(o+.5*n)].join(" "),h=this._createSvgElement("polygon",{points:r},["sky"]);this.element.appendChild(h)},e.prototype._mountWaves=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=o+n,r=e+t.w,h=[r+","+(o+.5*n),r+","+i,e+","+i].join(" "),p=this._createSvgElement("polygon",{points:h},["waves"]);this.element.appendChild(p)},e}(p),R=function(t){function e(e){t.call(this,e),this.melody=[13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this.__addSea(),this._addMiddleground(),this._addForeground(),this.__addHut()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype.__addHut=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i={boundingBox:{x:e+15,y:o+.7*n,height:o+.25*n,width:t.w-30},eventNode:this._eventNode,parent:this.element};new D(i)},e.prototype.__addSea=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new Y(e)},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new M(e)},e}(x);R.worldName="three-village";var q=function(t){var e=this;this.clock={minute:0,hour:5,day:1},this._boundingBox={x:0,y:0,h:100,w:100},this._eventNode=t,this._parent=t,this.__timeHandle=null,this.__worlds=[],Object.keys(this._getEventMap()).forEach((function(t){e._eventNode.addEventListener(t,e,!1)})),this._mount(t)};q.prototype.addWorlds=function(){var t=this,e=this._boundingBox,o={boundingBox:{x:e.x,y:e.y,height:e.h,width:e.w},eventNode:this._eventNode,parent:this.canvas.element};[{ctr:b,left:k.worldName,right:k.worldName,top:k.worldName},{ctr:k,left:k.worldName,right:k.worldName,top:k.worldName},{ctr:V,left:R.worldName,right:R.worldName,top:k.worldName},{ctr:R,left:V.worldName,right:V.worldName,top:R.worldName},{ctr:B,left:I.worldName,right:I.worldName,top:k.worldName},{ctr:I,left:B.worldName,right:B.worldName,top:I.worldName},{ctr:N,left:G.worldName,right:G.worldName,top:N.worldName},{ctr:G,left:N.worldName,right:N.worldName,top:G.worldName},{ctr:j,left:U.worldName,right:U.worldName,top:j.worldName},{ctr:U,left:j.worldName,right:j.worldName,top:U.worldName}].forEach((function(e){var n=new e.ctr(o);t.__worlds.push({instance:n,name:e.ctr.worldName,left:e.left,right:e.right,top:e.top}),n.addScene()}))},q.prototype.fireNewTime=function(){this.clock.minute+=1,this.clock.minute>=60&&(this.clock.hour+=1,this.clock.minute-=60),this.clock.hour>=24&&(this.clock.day+=1,this.clock.hour-=24);var e=new CustomEvent(t,{detail:this.clock});this._eventNode.dispatchEvent(e)},q.prototype.getCurrentWorld=function(){return this.__worlds.find((function(t){return t.instance.isActive()}))},q.prototype.handleEvent=function(t){var e=t.detail,o=t.isTrusted,n=t.target,i=t.type,r=this._getEventMap()[i];if(r)return o&&n?void r(n):!o&&e?void r(e):(console.warn("Unknown event type "+i),void r(t));console.warn("No callback for "+t.type)},q.prototype.init=function(){var t=b.worldName;this.addWorlds(),this.__addTime(),this.__addControls(),this.switchWorld({nextWorld:t})},q.prototype.pauseTime=function(){clearInterval(this.__timeHandle)},q.prototype.startTime=function(){this.__timeHandle=setInterval(this.fireNewTime.bind(this),33)},q.prototype.switchWorld=function(t){var e=t.nextWorld,o=this.__worlds.find((function(t){return t.name==e}));this.__worlds.forEach((function(t){return t.instance.setInactive()})),console.log("Transitioning to ",e,o),o&&o.instance.setActive()},q.prototype._getEventMap=function(){var t;return(t={})[e]=this.__handleGameControlsTurn.bind(this),t[n]=this.switchWorld.bind(this),t},q.prototype._mount=function(t){var e={boundingBox:{x:0,y:0,height:100,width:100},parent:this._parent,eventNode:this._eventNode};this.navigation=new v(e),this.canvas=new a(e)},q.prototype.__addControls=function(){var t={boundingBox:{x:this._boundingBox.x+this._boundingBox.w-15,y:this._boundingBox.y+this._boundingBox.h-10,height:10,width:15},eventNode:this._eventNode,parent:this.canvas.element};new s(t)},q.prototype.__addTime=function(){var t=this._boundingBox,e={boundingBox:{x:.8*t.h,y:.95*t.w},eventNode:this._eventNode,parent:this.canvas.element};new d(e)},q.prototype.__handleGameControlsTurn=function(t){var e=this.getCurrentWorld()[t.direction];this.switchWorld({nextWorld:e})};var X=new q(document.querySelector("#app"));X.init();var z=!0;document.getElementById("action").addEventListener("click",(function(){z?X.startTime():X.pauseTime(),z=!z}),!1)}();
</script>

</body></html>