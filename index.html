<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>JS13kgames 2020 - 404</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>*{margin:0;padding:0}:root{--scroll-distance:1.5em;--text-color:black;--background-color:white}@media (prefers-color-scheme:dark){:root,html.dark-theme{--text-color:#eee;--background-color:#333}}@media (prefers-color-scheme:light){:root,html.light-theme{--text-color:#333;--background-color:#eee}}html{scroll-padding-top:var(--scroll-distance)}body{color:var(--text-color);background-color:var(--background-color);scroll-padding-top:var(--scroll-distance)}#app{display:flex;align-items:center;height:95vmin;width:95vmin;margin:auto}#app>*{margin:.5em}#app.right-handedness{flex-direction:row}#app.left-handedness{flex-direction:row-reverse}nav{margin-bottom:1em;margin-block-end:1em}.nav-list{display:flex;flex-wrap:wrap;list-style:none;align-items:center}.nav-list__item{flex:1;text-align:center;margin:.5em}.nav-link,.nav-link:visited{color:var(--text-color);padding:.5em}.nav-link:active,.nav-link:hover{color:var(--background-color);background-color:var(--text-color)}.tab-view:not(:target){display:none}svg{background-color:#fff;flex-shrink:0;display:block;height:50vmin;width:50vmin;margin-left:auto;margin-right:auto;margin-inline-start:auto;margin-inline-end:auto}.logo__button__text,.logo__image{animation-duration:2s;animation-timing-function:linear;animation-delay:0;animation-iteration-count:1;animation-direction:normal;animation-fill-mode:forwards}.logo__image{fill:transparent;stroke:#000;stroke-dasharray:1;stroke-dashoffset:1;animation-name:handwrite}.logo__button__text{fill:transparent;stroke:#000}.logo__button__text{animation-name:fade-in}.hidden.world{display:none}.background,.foreground,.middleground{fill:hsl(var(--hue),var(--saturation),var(--luminance))}.five-portal,.four-portal,.six-portal,.three-portal{fill:transparent;stroke-width:var(--strokeWidth);stroke:hsl(var(--hue),var(--saturation),var(--luminance))}.sun{fill:gold}.speaker-box,.textbox{fill:hsl(var(--hue),var(--saturation),var(--luminance));stroke:#000;stroke-width:var(--strokeWidth)}.speaker-box__text,.textbox__text{fill:#fff;font-family:var(--fontFamily)}.logo__button__text{font-size:.65em}.speaker-box__text,.textbox__text,.time{font-size:.2em}.speaker-avatar__pic--narrator{stroke:hsl(var(--hue),var(--saturation),var(--luminance))}@keyframes fade-in{from{fill:transparent}to{fill:#000}}@keyframes handwrite{from{stroke-dashoffset:1}to{stroke-dashoffset:0}}</style></head>
<body>
<noscript>
I'm deeply sorry, but this game requires JavaScript to run.
</noscript>
<main id="app"></main>
<script>/**
 * This file is part of JS13kGames - 404.
 * An Offline Life is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * An Offline Life is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with An Offline Life.  If not, see <https://www.gnu.org/licenses/>.
 */

!function(){"use strict";var t="left",e="right",o="top",n={HANDEDNESS:"game:handedness:change",INTRO:"game:memory:narrator",TICK:"game:time:update",TURN:"game:controls:turn",VOLUME:"game:volume:change",WIND:"world:weather:wind",WORLD:"game:world:switch"},i="left",r="right",h="Game started",s="Met the narrator",a={c:130.81,d:146.83,e:164.81,f:174.61,g:196,a:220,h:246.91,C:261.63,D:293.66,E:329.63,F:349.23,G:392,A:440,H:493.88,B:523.25},p="fantasy",_="serif",d="medium",u="still",l="strong",c="base",y="five-portal",m="five-town",g="four-castle",v="four-portal",f="intro",x="portal",w="six-mountain",b="six-portal",E="three-portal",C="three-village",N="title",S=function(t){function e(e){t.call(this,e),this._mount(e.parent)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._createHtmlElement=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=[]);var n=document.createElement(t);return Object.keys(e).forEach((function(t){var o=e[t];n.setAttribute(t,o)})),o.forEach((function(t){n.classList.add(t)})),n},e.prototype._createSvgElement=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=[]);var n=document.createElementNS("http://www.w3.org/2000/svg",t);return Object.keys(e).forEach((function(t){var o=e[t];n.setAttributeNS(null,t,o)})),o.forEach((function(t){n.classList.add(t)})),n},e.prototype._mount=function(t){throw new Error("Requires implementation")},e}(function(t){function e(e){if(t.call(this,e),e.controls){var o=e.controls,n=o.x,i=o.y,r=o.height,h=o.width,s=o.isOnRight;this._controls={x:n,y:i,height:r,width:h,isOnRight:s}}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(function(t){function e(e){t.call(this,e),this._sympathy=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mapSympathyToLuminance=function(){return 50+this._sympathy/2},e.prototype._updateView=function(){if(t.prototype._updateView.call(this),!this.element)throw new Error("Requires Element");var e=this._mapSympathyToLuminance();this.element.style.setProperty("--luminance",e+"%","")},e}(function(t){function e(e){t.call(this,e),this._life=100}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._updateView=function(){if(!this.element)throw new Error("Requires Element");this.element.style.setProperty("--saturation",this._life+"%","")},e}(function(t){function e(e){var o=this;t.call(this,e),this._eventNode=e.eventNode,Object.keys(this._getEventMap()).forEach((function(t){o._eventNode.addEventListener(t,o,!1)}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.handleEvent=function(t){var e=t.detail,o=t.isTrusted,n=t.target,i=t.type,r=this._getEventMap()[i];if(r)return o&&n?void r(n):!o&&e?void r(e):void console.warn("Unknown event type "+i);console.warn("No callback for "+t.type)},e.prototype._getEventMap=function(){return{}},e}((function(t){var e=t.boundingBox,o=e.x,n=e.y,i=e.height,r=e.width;this._boundingBox={x:o,y:n,h:i,w:r}})))))),B=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("svg",{viewBox:o+" "+n+" "+r+" "+i},[]),this.element.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.appendChild(this.element)},e}(S),T=function(i){function h(){i.apply(this,arguments)}return i&&(h.__proto__=i),h.prototype=Object.create(i&&i.prototype),h.prototype.constructor=h,h.prototype._getEventMap=function(){var t;return(t={})[n.HANDEDNESS]=this.__handleHandednessChange.bind(this),t.click=this.__handleClick.bind(this),t},h.prototype._mount=function(t){this.element=this._createSvgElement("g",{"data-handedness":r},["controls"]),t.appendChild(this.element),this.__mountLeft(),this.__mountTop(),this.__mountRight()},h.prototype._updateView=function(){var t=this;Array.from(this.element.querySelectorAll(".control")).forEach((function(e){var o="";e.classList.contains("left")?o=t.__getLeftControlsPoints():e.classList.contains("right")?o=t.__getRightControlsPoints():e.classList.contains("top")&&(o=t.__getTopControlsPoints()),e.setAttributeNS(null,"points",o)}))},h.prototype.__getLeftControlsPoints=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=this._controls,h=r.height,s=r.width,a=o+n-h/2,p=a+h/2,_=r.isOnRight?e+i-s:e,d=_+s/3;return[d+","+a,d+","+p,_+","+(a+p)/2].join(" ")},h.prototype.__getRightControlsPoints=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=this._controls,h=r.height,s=r.width,a=o+n-h/2,p=a+h/2,_=r.isOnRight?e+i-s/3:e+s-s/3;return[_+","+a,_+","+p,_+s/3+","+(a+p)/2].join(" ")},h.prototype.__getTopControlsPoints=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=this._controls,h=r.height,s=r.width,a=o+n-h,p=a+h/2,_=r.isOnRight?e+i-s+s/3:e+s/3,d=_+s/3;return[d+","+p,_+","+p,(d+_)/2+","+a].join(" ")},h.prototype.__handleClick=function(i){var r=i.classList.contains("left"),h=i.classList.contains("right"),s=i.classList.contains("top");if(r){var a=new CustomEvent(n.TURN,{detail:{direction:t}});this._eventNode.dispatchEvent(a)}else if(h){var p=new CustomEvent(n.TURN,{detail:{direction:e}});this._eventNode.dispatchEvent(p)}else if(s){var _=new CustomEvent(n.TURN,{detail:{direction:o}});this._eventNode.dispatchEvent(_)}else;},h.prototype.__handleHandednessChange=function(t){this._controls.isOnRight=t.handedness===r,this._updateView()},h.prototype.__mountLeft=function(){var t=this._createSvgElement("polygon",{points:this.__getLeftControlsPoints()},["left","control"]);this.element.appendChild(t)},h.prototype.__mountRight=function(){var t=this._createSvgElement("polygon",{points:this.__getRightControlsPoints()},["right","control"]);this.element.appendChild(t)},h.prototype.__mountTop=function(){var t=this._createSvgElement("polygon",{points:this.__getTopControlsPoints()},["top","control"]);this.element.appendChild(t)},h}(S),O=function(t){function e(e){t.call(this,e),this.clock={hour:0,minute:0}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this._handleGameTimeUpdate.bind(this),t},e.prototype._handleGameTimeUpdate=function(t){if(void 0!==t.hour)if(void 0!==t.minute){var e=t.hour,o=("00"+t.minute).slice(-2);this.clock={hour:e,minute:o},this._updateView()}else console.warn("Invalid event",t);else console.warn("Invalid event",t)},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y;this.element=this._createSvgElement("text",{x:o,y:n},["time"]);var i=document.createTextNode("");this.element.appendChild(i),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this);var e=this.clock,o=e.hour,n=e.minute;this.element.textContent=o+":"+n},e}(S),k={DEBUG:"Debug",DEBUG_BUTTON:"Start time",HANDEDNESS:"Handedness",HANDEDNESS_LEFT:"Left-handed",HANDEDNESS_RIGHT:"Right-handed",INVENTORY:"Inventory",LANGUAGE:"Language",LANGUAGE_EN:"English",MEMORY:"Memory",NEW_GAME:"New Game",NO_ITEMS:"No items.",NO_MEMORIES:"Make some encounters.",SETTINGS:"Settings",TYPING:"Typing speed",VOLUME:"Volume",WELCOME:["Oh, good that you are there!","We need your help!"]};function M(t){return k[t]}var V=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createHtmlElement("section",{},["tab-view"]);var e=this._createHtmlElement("h2",{},["tab-view__header"]),o=document.createTextNode("");e.appendChild(o),this.element.appendChild(e);var n=document.createTextNode("");this.element.appendChild(n),t.appendChild(this.element)},e}(S),j=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-debug"),this.element.querySelector(".tab-view__header").textContent=M("DEBUG"),this._mountDebug()},e.prototype._mountDebug=function(){var t=this._createHtmlElement("button",{id:"action",type:"button"},[]);t.textContent=M("DEBUG_BUTTON"),this.element.appendChild(t)},e}(V),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-inventory"),this.element.querySelector(".tab-view__header").textContent=M("INVENTORY"),this.__mountInventory()},e.prototype.__mountInventory=function(){var t=this._createHtmlElement("p",{},[]),e=document.createTextNode(M("NO_ITEMS"));t.appendChild(e),this.element.appendChild(t)},e}(V),L=function(t){function e(e){t.call(this,e),this.__memories=[],this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.NARRATOR]=this.__handleMetNarrator.bind(this),t},e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-memory"),this.__mountMemory()},e.prototype._updateView=function(){this.element.querySelector(".tab-view__header").textContent=M("MEMORY"),this.__clearMemories(),this.__renderMemories()},e.prototype.__clearMemories=function(){var t=this.element.querySelector(".memories");t&&t.children.length>0&&Array.from(t.children).forEach((function(e){t.removeChild(e)}))},e.prototype.__handleMetNarrator=function(t){this.__memories.push(t),this._updateView()},e.prototype.__mountMemory=function(){var t=this._createHtmlElement("p",{},[]),e=document.createTextNode("");t.appendChild(e),this.element.appendChild(t)},e.prototype.__renderMemories=function(){var t=this;if(this.__memories.length>0){this.element.querySelector("p").textContent="";var e=this._createHtmlElement("ol",{},["memories"]);this.element.appendChild(e),this.__memories.forEach((function(o){var n=t._createHtmlElement("li",{},["memory"]),i=o.who,r=o.when,h=o.what,s=o.why,a=o.where,p=document.createTextNode("\n          I "+h+" „"+i+"” in "+a+" at "+r+" because "+s+"\n        ");n.appendChild(p),e.appendChild(n)}))}else this.element.querySelector("p").textContent=M("NO_MEMORIES")},e}(V),A=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){return{change:this.__handleChange.bind(this)}},e.prototype._mount=function(e){t.prototype._mount.call(this,e),this.element.setAttribute("id","tab-settings"),this.element.querySelector(".tab-view__header").textContent=M("SETTINGS"),this.__mountForm()},e.prototype.__handleChange=function(t){switch(t.nodeName.toLowerCase()){case"input":this.__handleVolumeChange(t);break;case"select":this.__handleHandednessChange(t);break;default:console.warn("Unhandled change event",t)}},e.prototype.__handleHandednessChange=function(t){var e=Array.from(t.selectedOptions);if(1===e.length){var o=e[0].value,i=new CustomEvent(n.HANDEDNESS,{detail:{handedness:o}});this._eventNode.dispatchEvent(i)}},e.prototype.__handleVolumeChange=function(t){var e=t.valueAsNumber,o=new CustomEvent(n.VOLUME,{detail:{volume:e}});this._eventNode.dispatchEvent(o)},e.prototype.__mountForm=function(){var t=this._createHtmlElement("form",{id:"form-settings",action:"#",method:"GET"},[]);this.__mountHandedness(t),this.__mountVolume(t),this.element.appendChild(t)},e.prototype.__mountHandedness=function(t){var e=this,o=this._createHtmlElement("label",{},[]),n=document.createTextNode(M("HANDEDNESS"));o.appendChild(n);var h=[{value:i,text:M("HANDEDNESS_LEFT"),selected:!1},{value:r,text:M("HANDEDNESS_RIGHT"),selected:!0}],s=this._createHtmlElement("select",{name:"handedness"},[]);h.forEach((function(t){var o=e._createHtmlElement("option",{value:t.value,selected:t.selected},[]),n=document.createTextNode(t.text);o.appendChild(n),s.add(o)})),t.appendChild(o),t.appendChild(s)},e.prototype.__mountLanguage=function(t){var e=this,o=[{value:"en",text:M("LANGUAGE_EN")}],n=this._createHtmlElement("fieldset",{},[]),i=this._createHtmlElement("legend",{},[]),r=document.createTextNode(M("LANGUAGE"));i.appendChild(r);var h=this._createHtmlElement("select",{name:"language"},[]),s=document.createTextNode(M("LANGUAGE"));h.appendChild(s),o.forEach((function(t){var o=e._createHtmlElement("option",{value:t.value},[]),n=document.createTextNode(t.text);o.appendChild(n),h.appendChild(o)})),n.appendChild(i),n.appendChild(h),t.appendChild(n)},e.prototype.__mountVolume=function(t){var e=this._createHtmlElement("label",{},["settings__label--volume"]),o=document.createTextNode(M("VOLUME"));e.appendChild(o);var n=this._createHtmlElement("input",{type:"range",min:0,max:1,value:.3,step:.1},["settings__label--volume__input"]);t.appendChild(e),t.appendChild(n)},e}(V),G=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createHtmlElement("section",{},[]),t.appendChild(this.element),this._mountNavigation()},e.prototype._mountNavigation=function(){var t=this,e=[{href:"#tab-inventory",text:M("INVENTORY")},{href:"#tab-memory",text:M("MEMORY")},{href:"#tab-settings",text:M("SETTINGS")},{href:"#tab-debug",text:M("DEBUG")}],o=this._createHtmlElement("nav",{},[]),n=this._createHtmlElement("ul",{},["nav-list"]);e.forEach((function(e){var o=t._createHtmlElement("li",{},["nav-list__item"]),i=t._createHtmlElement("a",{href:e.href},["nav-link"]),r=document.createTextNode(e.text);i.appendChild(r),o.appendChild(i),n.appendChild(o)})),o.appendChild(n),this.element.appendChild(o),this.__mountTabViews()},e.prototype.__mountTabViews=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},parent:this.element,eventNode:this._eventNode};this.tabs=[{id:"inventory",ref:new H(e)},{id:"memory",ref:new L(e)},{id:"settings",ref:new A(e)},{id:"debug",ref:new j(e)}]},e}(S),D=function(t){function e(e){t.call(this,e),this.name="",this.__clock={day:1,hour:0,minute:0},this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this.__handleGameTimeUpdate.bind(this),t},e.prototype._mount=function(e){t.prototype._mount.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w,s=.02*r,a=this._createSvgElement("rect",{x:n+.05*h,y:i+.53*r,height:.15*r,width:.2*h},["speaker-box"]);a.style.setProperty("--strokeWidth",s+"",""),this.element.appendChild(a);var p=this._createSvgElement("text",{x:n+.07*h,y:i+.63*r},["speaker-box__text"]),_=document.createTextNode("");p.appendChild(_),this.element.appendChild(p),this.element.querySelector(".textbox__text").setAttributeNS(null,"y",i+.78*r+"")},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".speaker-box").style.setProperty("--hue",this._hue+"","");var e=this.element.querySelector(".speaker-box__text");e.style.setProperty("--fontFamily",this.style+"",""),e.textContent=this.name},e.prototype.__handleGameTimeUpdate=function(t){var e=t.day,o=t.hour,n=t.minute;this.__clock.day=e,this.__clock.hour=o,this.__clock.minute=n},e}(function(t){function e(e){t.call(this,e),this.style=_,this.text=[""],this._hue=42}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.showText=function(t){this.text=t,this._updateView()},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.02*i;this.element=this._createSvgElement("g",{},[]);var s=o,a=r;this._controls&&(this._controls.isOnRight?this._controls.x<s+a&&(a=this._controls.x-s):this._controls.x+this._controls.width>s&&(s=this._controls.x+this._controls.width));var p=this._createSvgElement("rect",{x:s,y:n+.6*i,height:.5*i,width:a,rx:.02*r,ry:.02*r},["textbox"]);p.style.setProperty("--strokeWidth",h+"",""),this.element.appendChild(p);var _=this._createSvgElement("g",{},["textbox__text"]);this.element.appendChild(_),this.__showTextLines(),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".textbox").style.setProperty("--hue",this._hue+"",""),this.element.querySelector(".textbox__text").style.setProperty("--fontFamily",this.style+"",""),this.__clearText(),this.__showTextLines()},e.prototype.__clearText=function(){var t=this.element.querySelector(".textbox__text");t.children.length>0&&Array.from(t.children).forEach((function(e){return t.removeChild(e)}))},e.prototype.__showTextLines=function(){var t=this;if(this.text){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=this.element.querySelector(".textbox__text");this.text.forEach((function(e,s){var a=t._createSvgElement("text",{x:o+.03*r,y:n+.75*i+s*i*.1},[]),p=document.createTextNode(e);a.appendChild(p),h.appendChild(a)}))}},e}(S)),I=function(t){function e(e){t.call(this,e),this.name="???",this.style=p,this._hue=42,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.showText=function(e){t.prototype.showText.call(this,e),this.__makeMemory()},e.prototype._mount=function(e){t.prototype._mount.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w,s=n+.1*h,a=n+.2*h,p=i+.2*r,_=i+.5*r,d=[s+","+(p+.05*r),s+.05*h+","+p,a-.05*h+","+p,a+","+(p+.05*r),s+","+(_-.05*r),s+.05*h+","+_,a-.05*h+","+_,a+","+(_-.05*r)].join(" "),u=this._createSvgElement("ellipse",{cx:n+.15*h,cy:i+.5*r,rx:.11*h,ry:.35*r},["speaker-avatar__background"]),l=this._createSvgElement("polyline",{points:d},["speaker-avatar__pic","speaker-avatar__pic--narrator"]);l.setAttributeNS(null,"stroke-linecap","round"),this.element.insertBefore(l,this.element.firstChild),this.element.insertBefore(u,this.element.firstChild)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".speaker-avatar__pic--narrator").style.setProperty("--hue",this._hue+"","")},e.prototype.__makeMemory=function(){var t=this.__clock,e=t.day,o=t.hour,i=t.minute,r="Day "+e+" - "+[("00"+o).slice(-2),("00"+i).slice(-2)].join(":"),a={who:this.name,when:r,what:s,why:h,where:f},p=new CustomEvent(n.NARRATOR,{detail:a});this._eventNode.dispatchEvent(p)},e}(D),R=function(t){function e(e){t.call(this,e),this.melody=[],this._isActive=!1,this.__isPlayingMusic=!1,this.__volume=.3,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this._addMiddleground(),this._addForeground()},e.prototype.isActive=function(){return this._isActive},e.prototype.playMusic=function(){if(this.melody.length>0&&!this.__isPlayingMusic){var t=new AudioContext,e=t.createGain(),o=t.createOscillator();this.__isPlayingMusic=!0;var n=.1;o.connect(e).connect(t.destination),o.start(n),e.gain.setValueAtTime(this.__volume,n),this.melody.map((function(t){var e=t.slice(0,1);return{hz:a[e],time:.25*parseFloat(t.slice(1))}})).forEach((function(t,e){var i=t.hz,r=t.time;o.frequency.setValueAtTime(i,n),n+=r})),e.gain.setValueAtTime(0,n+.1),o.stop(n+.1),this.__isPlayingMusic=!1}},e.prototype.setActive=function(){this._isActive=!0,this._updateView(),this.playMusic()},e.prototype.setInactive=function(){this._isActive=!1,this._updateView()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype._getEventMap=function(){var t;return(t={})[n.VOLUME]=this.__handleGameVolumeChange.bind(this),t},e.prototype._mount=function(t){var e=["world","world--"+this.constructor.worldName];this.element=this._createSvgElement("g",{},e),t.appendChild(this.element)},e.prototype._rollDice=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=6),Math.floor(Math.random()*(e-t+t)+t)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.isActive()?this.element.classList.remove("hidden"):this.element.classList.add("hidden")},e.prototype.__handleGameVolumeChange=function(t){this.__volume=t.volume},e}(S);R.worldName=c;var W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addForeground(),this.__showIntro()},e.prototype._addForeground=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=this._controls,h=r.height,s=r.width,a=r.isOnRight,p={boundingBox:{x:e+.05*i,y:o+.4*n,height:.45*n,width:.9*i},controls:{x:this._controls.x,y:this._controls.y,height:h,width:s,isOnRight:a},eventNode:this._eventNode,parent:this.element};this._narrator=new I(p)},e.prototype._getEventMap=function(){return{click:this.__handleClick.bind(this)}},e.prototype.__handleClick=function(t){if(this.isActive()){var e=new CustomEvent(n.TURN,{detail:{direction:o}});this._eventNode.dispatchEvent(e)}},e.prototype.__showIntro=function(){this._narrator.showText(M("WELCOME"))},e}(R);W.worldName=f;var U=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){this.__mountLogo()},e.prototype._addForeground=function(){this.__mountButton()},e.prototype.__mountButton=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=this._createSvgElement("text",{x:e+.25*i,y:o+.85*n},["logo__button__text"]),h=document.createTextNode(M("NEW_GAME"));r.appendChild(h),this.element.appendChild(r)},e.prototype.__mountLogo=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=[e+.48*i+","+(o+.38*n),e+.1*i+","+(o+.6*n),e+.2*i+","+(o+.1*n),e+.4*i+","+(o+.7*n),e+.6*i+","+(o+.7*n),e+.8*i+","+(o+.1*n),e+.9*i+","+(o+.6*n),e+.52*i+","+(o+.38*n)].join(" "),h=this._createSvgElement("polyline",{pathLength:1,points:r},["logo__image"]);this.element.appendChild(h)},e}(R);U.worldName=N;var P=function(t){function e(e){t.call(this,e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this.__handleGameTimeUpdate.bind(this),t},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,s=[o+.5*r+","+(n+h),o+r-h+","+(n+.4*i),o+.7*r+","+(n+i-h),o+.3*r+","+(n+i-h),o+h+","+(n+.4*i)].join(" ");this.element=this._createSvgElement("polygon",{points:s},["five-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},e.prototype.__handleGameTimeUpdate=function(t){void 0!==t.hour&&void 0!==t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},e}(S),F=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new P(e)},e}(R);F.worldName=y;var q=function(t){function e(e){t.call(this,e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this.__handleGameTimeUpdate.bind(this),t},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,s=[o+.5*r+","+(n+h),o+r-h+","+(n+.5*i),o+.5*r+","+(n+i-h),o+h+","+(n+.5*i)].join(" ");this.element=this._createSvgElement("polygon",{points:s},["four-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},e.prototype.__handleGameTimeUpdate=function(t){void 0!==t.hour&&void 0!==t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},e}(S),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new q(e)},e}(R);Y.worldName=v;var X=function(t){function e(e){t.call(this,e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this.__handleGameTimeUpdate.bind(this),t},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,s=[o+.3*r+","+(n+h),o+.7*r+","+(n+h),o+r-h+","+(n+.5*i),o+.7*r+","+(n+i-h),o+.3*r+","+(n+i-h),o+h+","+(n+.5*i)].join(" ");this.element=this._createSvgElement("polygon",{points:s},["six-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},e.prototype.__handleGameTimeUpdate=function(t){void 0!==t.hour&&void 0!==t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},e}(S),K=function(t){function e(e){t.call(this,e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this.__handleGameTimeUpdate.bind(this),t},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.08*r,s=[o+.5*r+","+(n+h),o+r-h+","+(n+i-h),o+h+","+(n+i-h)].join(" ");this.element=this._createSvgElement("polygon",{points:s},["three-portal"]),this.element.style.setProperty("--strokeWidth",h+"",""),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"","")},e.prototype.__handleGameTimeUpdate=function(t){void 0!==t.hour&&void 0!==t.minute?(this._hue=(60*t.hour+t.minute)/1440*360,this._updateView()):console.warn("Invalid event",t)},e}(S),z=function(t){function e(e){t.call(this,e),this.__portalLength=.3}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){this.__portalLength=.3,this.__addThreePortal(),this.__addFourPortal(),this.__addFivePortal(),this.__addSixPortal()},e.prototype._getEventMap=function(){return{click:this.__handleClick.bind(this)}},e.prototype.__addFivePortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+i*(1-this.__portalLength),y:o+n*(.5-this.__portalLength/2),height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new P(r)},e.prototype.__addFourPortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e,y:o+n*(.5-this.__portalLength/2),height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new q(r)},e.prototype.__addSixPortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+i*(.5-this.__portalLength/2),y:o+n*(1-this.__portalLength),height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new X(r)},e.prototype.__addThreePortal=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+i*(.5-this.__portalLength/2),y:o,height:n*this.__portalLength,width:i*this.__portalLength},eventNode:this._eventNode,parent:this.element};new K(r)},e.prototype.__handleClick=function(t){var e=t.getAttribute("class");if(e&&(!e||e.includes("-portal"))){var o=new CustomEvent(n.WORLD,{detail:{nextWorld:e}});this._eventNode.dispatchEvent(o)}},e}(R);z.worldName=x;var J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new X(e)},e}(R);J.worldName=b;var Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h,width:t.w},eventNode:this._eventNode,parent:this.element};new K(e)},e}(R);Q.worldName=E;var Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["guild"]),t.appendChild(this.element),this._mountMarket()},e.prototype._mountMarket=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+i,h=o+n,s=[e+","+h,e+","+(o+.1*n),e+.5*i+","+o,r+","+(o+.1*n),r+","+h].join(" "),a=this._createSvgElement("polygon",{points:s},["market"]);this.element.appendChild(a)},e}(S),$=function(t){function e(e){t.call(this,e),this._radius=3,this._axisX=this._boundingBox.x,this._axisY=this._boundingBox.y}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getElementAttributes=function(){return this._radius=this._radius||3,this._axisX=this._axisX||this._boundingBox.x,this._axisY=this._axisY||this._boundingBox.y,{r:this._radius,cx:this._axisX,cy:this._axisY}},e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this._handleGameTimeUpdate.bind(this),t},e.prototype._handleGameTimeUpdate=function(t){if(void 0!==t.hour)if(void 0!==t.minute){var e=t.hour,o=t.minute,n=this._boundingBox,i=(n.x,n.y,n.h),r=n.w,h=-5;e>=6&&e<=18&&(h=r*(60*(e-6)+o)/720);var s=60*(e+6)+o,a=this._radius+i+i*Math.sin(s*Math.PI/720);this._axisX=h,this._axisY=a,this._updateView()}else console.warn("Invalid event",t);else console.warn("Invalid event",t)},e.prototype._mount=function(t){var e=this._getElementAttributes(),o=e.r,n=e.cx,i=e.cy;this.element=this._createSvgElement("circle",{r:o+"",cx:n-3*o+"",cy:i-3*o+""},["sun"]),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this);var e=this._axisX,o=this._axisY;this.element.setAttributeNS(null,"cx",e+""),this.element.setAttributeNS(null,"cy",o+"")},e}(S),tt=function(t){function e(e){t.call(this,e),this.melody=["a2","a1","h1","C4","C1","D1","E1","C1","D2","h2","h2","h2","h2","h2","h1","C1","D1","h1","C2","a2","a2","a1","h1","C2","C2","C1","D1","E1","C1","D2","h2","h1","C1","D1","h1","C2","h1","a1","g1","f1","a1","g1","a4"]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this._addMiddleground(),this._addForeground(),this.__addGuild()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype.__addGuild=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+.3*i,y:o+.2*n,height:.6*n,width:.4*i},eventNode:this._eventNode,parent:this.element};new Z(r)},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new $(e)},e}(R);tt.worldName=m;var et=function(t){function e(e){t.call(this,e),this._hue=211,this._saturation=70,this._luminance=50,this._timeoutHandle=null,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this._handleGameTimeUpdate.bind(this),t},e.prototype._handleGameTimeUpdate=function(t){var e=t.hour>5&&t.hour<8;t.hour>17&&t.hour<20&&(this._luminance-=.1),e&&(this._luminance+=.1),this._updateView()},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("rect",{x:o,y:n,height:i,width:r},["background"]),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")},e}(S),ot=function(t){function e(e){t.call(this,e),this._hue=140,this._life=50,this._luminance=50,this._timeoutHandle=null,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this._handleGameTimeUpdate.bind(this),t},e.prototype._handleGameTimeUpdate=function(t){var e=t.hour>5&&t.hour<8;t.hour>17&&t.hour<20&&(this._luminance-=.1),e&&(this._luminance+=.1),this._updateView()},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("rect",{x:o,y:n,height:i,width:r},["foreground"]),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")},e}(S),nt=function(t){function e(e){t.call(this,e),this._hue=140,this._life=50,this._luminance=30,this._timeoutHandle=null,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this._handleGameTimeUpdate.bind(this),t},e.prototype._handleGameTimeUpdate=function(t){var e=t.hour>5&&t.hour<8;t.hour>17&&t.hour<20&&(this._luminance-=.1),e&&(this._luminance+=.1),this._updateView()},e.prototype._mount=function(t){var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w;this.element=this._createSvgElement("rect",{x:o,y:n,height:i,width:r},["middleground"]),t.appendChild(this.element)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")},e}(S),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["castle"]),t.appendChild(this.element),this._mountLeftTower(),this._mountMain(),this._mountCrenellations(4),this._mountRightTower()},e.prototype._mountCrenellations=function(t){for(var e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h=.7*r/(2*t+1),s=o+.15*r,a=n+.1*i,p=n+.2*i,_=[s+","+p],d=1;d<2*t;d+=2){var u=s+(d+1)*h;_.push(s+d*h+","+p),_.push(s+d*h+","+a),_.push(u+","+a),_.push(u+","+p)}var l=this._createSvgElement("polygon",{points:_.join(" ")},["crenellations"]);this.element.appendChild(l)},e.prototype._mountLeftTower=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=e+.15*t.w,r=o+n,h=[e+","+r,e+","+o,i+","+o,i+","+r].join(" "),s=this._createSvgElement("polygon",{points:h},["tower"]);this.element.appendChild(s)},e.prototype._mountMain=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+.15*i,h=e+i-.15*i,s=o+.2*n,a=o+n,p=[r+","+a,r+","+s,h+","+s,h+","+a].join(" "),_=this._createSvgElement("polygon",{points:p},[]);this.element.appendChild(_)},e.prototype._mountRightTower=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+i-.15*i,h=e+i,s=o+n,a=[r+","+s,r+","+o,h+","+o,h+","+s].join(" "),p=this._createSvgElement("polygon",{points:a},["tower"]);this.element.appendChild(p)},e}(S),rt=function(t){function e(e){t.call(this,e),this.name="Leonhard",this.style=_,this._hue=80,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(e){t.prototype._mount.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w,s=n+.1*h,a=n+.2*h,p=i+.2*r,_=i+.7*r,d=[s+","+_,s+.02*h+","+p,a-.02*h+","+p,a+","+_].join(" "),u=this._createSvgElement("polyline",{points:d},["speaker-avatar__pic","speaker-avatar__pic--knight"]);this.element.insertBefore(u,this.element.firstChild)},e.prototype._updateView=function(){t.prototype._updateView.call(this),this.element.querySelector(".speaker-avatar__pic--knight").style.setProperty("--hue",this._hue+"","")},e}(D),ht=function(t){function e(e){t.call(this,e);var o=this._boundingBox,n=o.x,i=o.y,r=o.h,h=o.w;this._windStrength=u,this._axisX=n+.5*h,this._axisY=i+.3*r,this.degree=0,this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getEventMap=function(){var t;return(t={})[n.TICK]=this.__handleGameTimeUpdate.bind(this),t[n.WIND]=this.__handleWorldWeatherWind.bind(this),t},e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["mill"]),t.appendChild(this.element),this.__mountBuilding(),this.__mountWings()},e.prototype._updateView=function(){t.prototype._updateView.call(this);var e="rotate("+this._degree+","+(this._axisX+","+this._axisY)+")";this.element.querySelector(".wings").setAttributeNS(null,"transform",e)},e.prototype.__getElementAttributes=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w;return this._axisX=this._axisX||e+.5*i,this._axisY=this._axisY||o+.5*n,this._degree=this._degree||0,{axisX:this._axisX,axisY:this._axisY,degree:this._degree}},e.prototype.__handleGameTimeUpdate=function(t){if(void 0!==t.hour)if(void 0!==t.minute){var e=1.5;this._windStrength===d&&(e=6),this._windStrength===l&&(e=9),this._degree=t.minute*e,this._updateView()}else console.warn("Invalid event",t);else console.warn("Invalid event",t)},e.prototype.__handleWorldWeatherWind=function(t){this._windStrength=t.wind,this._updateView()},e.prototype.__mountBuilding=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=e+.3*i,h=e+.7*i,s=o+.3*n,a=o+n,p=[r+","+a,r+.1*i+","+s,h-.1*i+","+s,h+","+a].join(" "),_=this._createSvgElement("polygon",{points:p},[]);this.element.appendChild(_)},e.prototype.__mountWings=function(){var t=this._createSvgElement("g",{},["wings"]);this.__mountTopWing(t),this.__mountRightWing(t),this.__mountBottomWing(t),this.__mountLeftWing(t),this.element.appendChild(t)},e.prototype.__mountBottomWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this.__getElementAttributes(),r=i.axisX,h=i.axisY,s=r-.01*n,a=r+.01*n,p=h+.01*o,_=h+.3*o,d=_-.2*o,u=[a+","+p,a+","+_,s+","+_,s+","+d,a-.02*n+","+d,a-.02*n+","+p].join(" "),l=this._createSvgElement("polygon",{points:u},["bottom","wing"]);t.appendChild(l)},e.prototype.__mountLeftWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this.__getElementAttributes(),r=i.axisX,h=i.axisY,s=r-.3*n,a=r-.01*n,p=h-.1*o,_=h+.01*o,d=s+.2*n,u=[a+","+_,s+","+_,s+","+p,d+","+p,d+","+(_-.02*o),a+","+(_-.02*o)].join(" "),l=this._createSvgElement("polygon",{points:u},["left","wing"]);t.appendChild(l)},e.prototype.__mountRightWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this.__getElementAttributes(),r=i.axisX,h=i.axisY,s=r+.01*n,a=r+.3*n,p=h-.01*o,_=h+.1*o,d=a-.2*n,u=[s+","+p,a+","+p,a+","+_,d+","+_,d+","+(p+.02*o),s+","+(p+.02*o)].join(" "),l=this._createSvgElement("polygon",{points:u},["right","wing"]);t.appendChild(l)},e.prototype.__mountTopWing=function(t){var e=this._boundingBox,o=(e.x,e.y,e.h),n=e.w,i=this.__getElementAttributes(),r=i.axisX,h=i.axisY,s=r-.01*n,a=r+.1*n,p=h+.3*o,_=h-.01*o,d=p+.2*o,u=[s+","+_,s+","+p,a+","+p,a+","+d,s+.02*n+","+d,s+.02*n+","+_].join(" "),l=this._createSvgElement("polygon",{points:u},["top","wing"]);t.appendChild(l)},e}(S),st=function(t){function e(e){t.call(this,e),this.melody=["h3","C1","D2","D2","C1","h1","C1","D1","h2","f2","h3","C1","D2","D2","C1","h1","C1","D1","h4","h1","h1","h1","h1","h1","D1","F2","F1","G1","F1","E1","D1","C1","h2","F1","F1","F2","f1","f1","f2","F1","F1","F2","f1","f1","f2","F1","F1","F2","F1","f1","f2","F4","h3","C1","D2","D2","C1","h1","C1","D1","h4"],this.__windChangeHandle=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this._addMiddleground(),this.__addMill(),this.__addCastle(),this._addForeground(),this.__addKnight(),this.fireWindChange();this.__windChangeHandle=setInterval(this.fireWindChange.bind(this),4e3)},e.prototype.fireWindChange=function(){var t=this._rollDice(),e=new CustomEvent(n.WIND,{detail:{wind:[null,u,u,d,d,d,l][t]}});this._eventNode.dispatchEvent(e)},e.prototype._addBackground=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new et(e)},e.prototype._addForeground=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=o+n/3+n/5,r={boundingBox:{x:e,y:i,height:n-i,width:t.w},eventNode:this._eventNode,parent:this.element};new ot(r)},e.prototype._addMiddleground=function(){var t=this._boundingBox,e=t.x,o=(t.y,t.h),n={boundingBox:{x:e,y:o/3,height:o/5,width:t.w},eventNode:this._eventNode,parent:this.element};new nt(n)},e.prototype.__addCastle=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i={boundingBox:{x:e+15,y:o+.4*n,height:n/4,width:e+.75*t.w-30},eventNode:this._eventNode,parent:this.element};new it(i)},e.prototype.__addKnight=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=this._controls,h=r.height,s=r.width,a=r.isOnRight,p={boundingBox:{x:e+.05*i,y:o+.4*n,height:.45*n,width:.9*i},controls:{x:this._controls.x,y:this._controls.y,height:h,width:s,isOnRight:a},eventNode:this._eventNode,parent:this.element};new rt(p)},e.prototype.__addMill=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r={boundingBox:{x:e+.7*i,y:o+.3*n,height:.2*n,width:.2*i},eventNode:this._eventNode,parent:this.element};new ht(r)},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new $(e)},e}(R);st.worldName=g;var at=function(t){function e(e){t.call(this,e),this.melody=["H1","H1","H1","H1","B2","C1","C1","H2","G2","H2","G2","G1","G1","G1","G1","H2","H1","H1","G2","E2","G2","E2","E4","C1","D1","E1","C1","H4","H1","C1","H1","A1","G2","E2","E2","E2","E8"]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this._addMiddleground(),this._addForeground()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new $(e)},e}(R);at.worldName=w;var pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["hut"]),t.appendChild(this.element),this._mountRoof(),this._mountBuilding()},e.prototype._mountBuilding=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=o+.8*n,h=[e+.05*i+","+r,e+.5*i+","+o,e+.95*i+","+r].join(" "),s=this._createSvgElement("polygon",{points:h},[]);this.element.appendChild(s)},e.prototype._mountRoof=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=t.w,r=o+.6*n,h=[e+","+r,e+.5*i+","+o,e+i+","+r].join(" "),s=this._createSvgElement("polygon",{points:h},[]);this.element.appendChild(s)},e}(S),_t=function(t){function e(e){t.call(this,e),this._updateView()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._mount=function(t){this.element=this._createSvgElement("g",{},["sea"]),t.appendChild(this.element),this._mountSky(),this._mountWaves()},e.prototype._mountFilter=function(){this._filterId="sea-filter";var t=document.querySelector("#"+this._filterId);if(null===t){t=this._createSvgElement("filter",{id:this._filterId},[]);var e=this._createSvgElement("feTurbulence",{id:"turbulence",type:"turbulence",baseFrequency:"0.042",numOctaves:"1",result:"turbulence",seed:5},[]),o=this._createSvgElement("animate",{id:"animate",attributeName:"baseFrequency",values:"0;0.1;0;0",from:"0",to:"100",dur:"10s",repeatCount:"inifinte"},[]),n=this._createSvgElement("feDisplacementMap",{in:"SourceGraphic",in2:"turbulence",scale:"30",xChannelSelector:"R",yChannelSelector:"R"},[]);t.appendChild(e),t.appendChild(o),this.element.appendChild(t),this.element.appendChild(n)}},e.prototype._mountSky=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=e+t.w,r=[e+","+o,i+","+o,i+","+(o+.5*n)].join(" "),h=this._createSvgElement("polygon",{points:r},["sky"]);this.element.appendChild(h)},e.prototype._mountWaves=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i=o+n,r=e+t.w,h=[r+","+(o+.5*n),r+","+i,e+","+i].join(" "),s=this._createSvgElement("polygon",{points:h},["waves"]);this.element.appendChild(s)},e}(S),dt=function(t){function e(e){t.call(this,e),this.melody=["C1","C0.5","C0.5","C1","C0.5","C0.5","C1","f1","a1","c1","h1","h0.5","h0.5","h1","h0.5","h0.5","h1","e1","g1","h1","C1","C0.5","C0.5","C1","C0.5","C0.5","C1","D1","E1","F1","E1","C1","h1","g1","f2","f2"]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addScene=function(){this._addBackground(),this.__addSun(),this.__addSea(),this._addMiddleground(),this._addForeground(),this.__addHut()},e.prototype._addBackground=function(){},e.prototype._addForeground=function(){},e.prototype._addMiddleground=function(){},e.prototype.__addHut=function(){var t=this._boundingBox,e=t.x,o=t.y,n=t.h,i={boundingBox:{x:e+15,y:o+.7*n,height:o+.25*n,width:t.w-30},eventNode:this._eventNode,parent:this.element};new pt(i)},e.prototype.__addSea=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new _t(e)},e.prototype.__addSun=function(){var t=this._boundingBox,e={boundingBox:{x:t.x,y:t.y,height:t.h/3,width:t.w},eventNode:this._eventNode,parent:this.element};new $(e)},e}(R);dt.worldName=C;var ut=function(t){var e=this;this.clock={minute:0,hour:0,day:1},this._boundingBox={x:0,y:0,h:100,w:100},this._eventNode=t,this._parent=t,this.__controlsHeight=10,this.__controlsWidth=15,this.__timeHandle=null,this.__worlds=[],Object.keys(this._getEventMap()).forEach((function(t){e._eventNode.addEventListener(t,e,!1)})),this._mount(t)};ut.prototype.addWorlds=function(){var t=this,e=this._boundingBox,o=e.x,n=e.y,i=e.h,r=e.w,h={boundingBox:{x:o,y:n,height:i,width:r},controls:{x:o+r-this.__controlsWidth,y:n+i-this.__controlsHeight,height:this.__controlsHeight,width:this.__controlsWidth,isOnRight:!0},eventNode:this._eventNode,parent:this.canvas.element};[{ctr:U,left:f,right:f,top:f},{ctr:W,left:x,right:x,top:x},{ctr:Q,left:C,right:C,top:x},{ctr:dt,left:E,right:E,top:C},{ctr:Y,left:g,right:g,top:x},{ctr:st,left:v,right:v,top:g},{ctr:F,left:m,right:m,top:x},{ctr:tt,left:y,right:y,top:m},{ctr:J,left:w,right:w,top:x},{ctr:at,left:b,right:b,top:w},{ctr:z,left:x,right:x,top:x}].forEach((function(e){var o=new e.ctr(h);t.__worlds.push({instance:o,name:e.ctr.worldName,left:e.left,right:e.right,top:e.top}),o.addScene()}))},ut.prototype.fireNewTime=function(){this.clock.minute+=1,this.clock.minute>=60&&(this.clock.hour+=1,this.clock.minute-=60),this.clock.hour>=24&&(this.clock.day+=1,this.clock.hour-=24);var t=new CustomEvent(n.TICK,{detail:this.clock});this._eventNode.dispatchEvent(t)},ut.prototype.getCurrentWorld=function(){return this.__worlds.find((function(t){return t.instance.isActive()}))},ut.prototype.handleEvent=function(t){var e=t.detail,o=t.isTrusted,n=t.target,i=t.type,r=this._getEventMap()[i];if(r)return o&&n?void r(n):!o&&e?void r(e):(console.warn("Unknown event type "+i),void r(t));console.warn("No callback for "+t.type)},ut.prototype.init=function(){var t=U.worldName;this.__respondToDevice(),this.addWorlds(),this.__addTime(),this.__addControls(),this.startTime(),this.switchWorld({nextWorld:t})},ut.prototype.pauseTime=function(){clearInterval(this.__timeHandle)},ut.prototype.startTime=function(){this.__timeHandle=setInterval(this.fireNewTime.bind(this),250)},ut.prototype.switchWorld=function(t){var e=t.nextWorld,o=this.__worlds.find((function(t){return t.name==e}));this.__worlds.forEach((function(t){return t.instance.setInactive()})),o&&o.instance.setActive()},ut.prototype._getEventMap=function(){var t;return(t={})[n.HANDEDNESS]=this.__handleHandednessChange.bind(this),t[n.TURN]=this.__handleGameControlsTurn.bind(this),t[n.WORLD]=this.switchWorld.bind(this),t},ut.prototype._mount=function(t){var e={boundingBox:{x:0,y:0,height:100,width:100},parent:this._parent,eventNode:this._eventNode};this.navigation=new G(e),this.canvas=new B(e)},ut.prototype.__addControls=function(){var t=this._boundingBox,e=t.x,o=t.y,n={boundingBox:{x:e,y:o,height:t.h,width:t.w},controls:{x:e,y:o,height:this.__controlsHeight,width:this.__controlsWidth,isOnRight:!0},eventNode:this._eventNode,parent:this.canvas.element};new T(n)},ut.prototype.__addTime=function(){var t=this._boundingBox,e={boundingBox:{x:.8*t.h,y:.95*t.w},eventNode:this._eventNode,parent:this.canvas.element};new O(e)},ut.prototype.__handleGameControlsTurn=function(t){var e=this.getCurrentWorld()[t.direction];this.switchWorld({nextWorld:e})},ut.prototype.__handleHandednessChange=function(t){var e=t.handedness;this._parent.classList.remove("left-handedness"),this._parent.classList.remove("right-handedness"),this._parent.classList.add(e+"-handedness")},ut.prototype.__respondToDevice=function(){var t=5;window.matchMedia("(pointer: coarse)").matches&&(t=10),this.__controlsHeight=2*t,this.__controlsWidth=3*t};var lt=new ut(document.querySelector("#app"));lt.init();var ct=!0;document.getElementById("action").addEventListener("click",(function(){ct?lt.startTime():lt.pauseTime(),ct=!ct}),!1)}();
</script>

</body></html>