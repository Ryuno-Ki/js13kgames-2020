<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<title>JS13kgames 2020 - 404</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>*{margin:0;padding:0}:root{--scroll-distance:1.5em}html{scroll-padding-top:var(--scroll-distance)}body{color:#000;background-color:#fff;scroll-padding-top:var(--scroll-distance)}#app{display:flex;align-items:center}#app.right-handedness{flow-direction:row}#app-left-handedness{flow-direction:row-reverse}.nav-list{display:flex;flex-wrap:wrap;list-style:none;align-items:center}.nav-list__item{flex:1;margin:.5em;text-align:center}.tab-view:not(:target){display:none}svg{flex-shrink:0;display:block;height:98vmin;width:98vmin;margin-left:auto;margin-right:auto;margin-inline-start:auto;margin-inline-end:auto}.hidden.world{display:none}.background,.foreground,.middleground{fill:hsl(var(--hue),var(--saturation),var(--luminance))}.five-portal,.four-portal,.six-portal,.three-portal{fill:transparent;stroke-width:var(--strokeWidth);stroke:hsl(var(--hue),var(--saturation),var(--luminance))}.sun{fill:gold}.speaker-box,.textbox{fill:hsl(var(--hue),var(--saturation),var(--luminance));stroke:#000;stroke-width:var(--strokeWidth)}.speaker-box__text,.textbox__text{fill:#fff;font-family:var(--fontFamily)}.speaker-box__text,.textbox__text,.time{font-size:.2em}.speaker-avatar__pic--narrator{stroke:hsl(var(--hue),var(--saturation),var(--luminance))}</style></head>
<body>
<noscript>
I'm deeply sorry, but this game requires JavaScript to run.
</noscript>
<main id="app"></main>
<script>/**
 * This file is part of JS13kGames - 404.
 * An Offline Life is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * An Offline Life is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with An Offline Life.  If not, see <https://www.gnu.org/licenses/>.
 */

!function(){"use strict";const e="game:time:update",t="game:controls:turn",n="world:weather:wind",i="game:world:switch",s="fantasy",o="serif";class h extends class extends class extends class extends class{constructor(e){const{x:t,y:n,height:i,width:s}=e.boundingBox;this._boundingBox={x:t,y:n,h:i,w:s}}}{constructor(e){super(e),this._eventNode=e.eventNode,Object.keys(this._getEventMap()).forEach(e=>{this._eventNode.addEventListener(e,this,!1)})}handleEvent(e){const{detail:t,isTrusted:n,target:i,type:s}=e,o=this._getEventMap()[s];if(o)return n&&i?void o(i):!n&&t?void o(t):(console.warn("Unknown event type "+s),void o(e));console.warn("No callback for "+e.type)}_getEventMap(){return{}}}{constructor(e){super(e),this._life=100}_updateView(){if(!this.element)throw new Error("Requires Element");this.element.style.setProperty("--saturation",this._life+"%","")}}{constructor(e){super(e),this._sympathy=0}_mapSympathyToLuminance(){return 50+this._sympathy/2}_updateView(){if(super._updateView(),!this.element)throw new Error("Requires Element");const e=this._mapSympathyToLuminance();this.element.style.setProperty("--luminance",e+"%","")}}{constructor(e){super(e),this._mount(e.parent)}_createHtmlElement(e,t={},n=[]){const i=document.createElement(e);return Object.keys(t).forEach(e=>{const n=t[e];i.setAttribute(e,n)}),n.forEach(e=>{i.classList.add(e)}),i}_createSvgElement(e,t={},n=[]){const i=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach(e=>{const n=t[e];i.setAttributeNS(null,e,n)}),n.forEach(e=>{i.classList.add(e)}),i}_mount(e){throw new Error("Requires implementation")}}class d extends h{_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox;this.element=this._createSvgElement("svg",{viewBox:`${t} ${n} ${s} ${i}`},[]),this.element.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.appendChild(this.element)}}class a extends h{_getEventMap(){return{click:this.__handleClick.bind(this)}}_mount(e){this.element=this._createSvgElement("g",{},["controls"]),e.appendChild(this.element),this.__mountLeft(),this.__mountTop(),this.__mountRight()}__handleClick(e){const n=e.classList.contains("left"),i=e.classList.contains("right"),s=e.classList.contains("top");if(n){const e=new CustomEvent(t,{detail:{direction:"left"}});this._eventNode.dispatchEvent(e)}if(i){const e=new CustomEvent(t,{detail:{direction:"right"}});this._eventNode.dispatchEvent(e)}if(s){const e=new CustomEvent(t,{detail:{direction:"top"}});this._eventNode.dispatchEvent(e)}}__mountLeft(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+n/2,o=t+n,h=e+i/3,d=[h+","+s,h+","+o,e+","+(s+o)/2].join(" "),a=this._createSvgElement("polygon",{points:d},["left","control"]);this.element.appendChild(a)}__mountRight(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+n/2,o=t+n,h=e+2*i/3,d=[h+","+s,h+","+o,e+i+","+(s+o)/2].join(" "),a=this._createSvgElement("polygon",{points:d},["right","control"]);this.element.appendChild(a)}__mountTop(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+n/2,o=e+i/3,h=e+2*i/3,d=[h+","+s,o+","+s,(h+o)/2+","+t].join(" "),a=this._createSvgElement("polygon",{points:d},["top","control"]);this.element.appendChild(a)}}class r extends h{constructor(e){super(e),this.clock={hour:0,minute:0}}_getEventMap(){return{[e]:this._handleGameTimeUpdate.bind(this)}}_handleGameTimeUpdate(e){if(!e.hour||!e.minute)return void console.warn("Invalid event",e);const t=e.hour,n=("00"+e.minute).slice(-2);this.clock={hour:t,minute:n},this._updateView()}_mount(e){const{x:t,y:n}=this._boundingBox;this.element=this._createSvgElement("text",{x:t,y:n},["time"]);const i=document.createTextNode("");this.element.appendChild(i),e.appendChild(this.element)}_updateView(){super._updateView();const{hour:e,minute:t}=this.clock;this.element.textContent=`${e}:${t}`}}const l={DEBUG:"Debug",DEBUG_BUTTON:"Start time",INVENTORY:"Inventory",LANGUAGE:"Language",LANGUAGE_EN:"English",MEMORY:"Memory",NO_ITEMS:"No items.",NO_MEMORIES:"Make some encounters.",SETTINGS:"Settings",TYPING:"Typing speed",WELCOME:"Welcome, stranger"};function _(e){return l[e]}class u extends h{_mount(e){this.element=this._createHtmlElement("section",{},["tab-view"]);const t=this._createHtmlElement("h2",{},["tab-view__header"]),n=document.createTextNode("");t.appendChild(n),this.element.appendChild(t);const i=document.createTextNode("");this.element.appendChild(i),e.appendChild(this.element)}}class c extends u{_mount(e){super._mount(e),this.element.setAttribute("id","tab-debug"),this.element.querySelector(".tab-view__header").textContent=_("DEBUG"),this._mountDebug()}_mountDebug(){const e=this._createHtmlElement("button",{id:"action",type:"button"},[]);e.textContent=_("DEBUG_BUTTON"),this.element.appendChild(e)}}class m extends u{_mount(e){super._mount(e),this.element.setAttribute("id","tab-inventory"),this.element.querySelector(".tab-view__header").textContent=_("INVENTORY"),this.__mountInventory()}__mountInventory(){const e=this._createHtmlElement("p",{},[]),t=document.createTextNode(_("NO_ITEMS"));e.appendChild(t),this.element.appendChild(e)}}class p extends u{_mount(e){super._mount(e),this.element.setAttribute("id","tab-memory"),this.element.querySelector(".tab-view__header").textContent=_("MEMORY"),this.__mountMemory()}__mountMemory(){const e=this._createHtmlElement("p",{},[]),t=document.createTextNode(_("NO_MEMORIES"));e.appendChild(t),this.element.appendChild(e)}}class g extends u{_mount(e){super._mount(e),this.element.setAttribute("id","tab-settings"),this.element.querySelector(".tab-view__header").textContent=_("SETTINGS"),this.__mountForm()}__mountForm(){const e=[{value:"en",text:_("LANGUAGE_EN")}],t=this._createHtmlElement("form",{id:"form-settings",action:"#",method:"GET"},[]),n=this._createHtmlElement("fieldset",{},[]),i=this._createHtmlElement("legend",{},[]),s=document.createTextNode(_("LANGUAGE"));i.appendChild(s);const o=this._createHtmlElement("select",{name:"language"},[]),h=document.createTextNode(_("LANGUAGE"));o.appendChild(h),e.forEach(e=>{const t=this._createHtmlElement("option",{value:e.value},[]),n=document.createTextNode(e.text);t.appendChild(n),o.appendChild(t)});const d=this._createHtmlElement("label",{},[]),a=document.createTextNode(_("TYPING"));d.appendChild(a);const r=this._createHtmlElement("input",{type:"range",min:1,max:3,step:1},[]);n.appendChild(i),n.appendChild(o),n.appendChild(d),n.appendChild(r),t.appendChild(n),this.element.appendChild(t)}}class x extends h{_mount(e){this.element=this._createHtmlElement("section",{},[]),e.appendChild(this.element),this._mountNavigation()}_mountNavigation(){const e=[{href:"#tab-inventory",text:_("INVENTORY")},{href:"#tab-memory",text:_("MEMORY")},{href:"#tab-settings",text:_("SETTINGS")},{href:"#tab-debug",text:_("DEBUG")}],t=this._createHtmlElement("nav",{},[]),n=this._createHtmlElement("ul",{},["nav-list"]);e.forEach(e=>{const t=this._createHtmlElement("li",{},["nav-list__item"]),i=this._createHtmlElement("a",{href:e.href},["nav-link"]),s=document.createTextNode(e.text);i.appendChild(s),t.appendChild(i),n.appendChild(t)}),t.appendChild(n),this.element.appendChild(t),this.__mountTabViews()}__mountTabViews(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n,width:i},parent:this.element,eventNode:this._eventNode};this.tabs=[{id:"inventory",ref:new m(s)},{id:"memory",ref:new p(s)},{id:"settings",ref:new g(s)},{id:"debug",ref:new c(s)}]}}class w extends h{constructor(e){super(e),this.style=o,this.text="",this._hue=42}showText(e,t){this.style=t||o,this.text=e,this._updateView()}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.02*i;this.element=this._createSvgElement("g",{},[]);const h=this._createSvgElement("rect",{x:t,y:n+.6*i,height:.5*i,width:s,rx:.02*s,ry:.02*s},["textbox"]);h.style.setProperty("--strokeWidth",o+"",""),this.element.appendChild(h);const d=this._createSvgElement("text",{x:t+.03*s,y:n+.73*i},["textbox__text"]),a=document.createTextNode("");d.appendChild(a),this.element.appendChild(d),e.appendChild(this.element)}_updateView(){super._updateView();this.element.querySelector(".textbox").style.setProperty("--hue",this._hue+"","");const e=this.element.querySelector(".textbox__text");e.style.setProperty("--fontFamily",this.style+"",""),e.textContent=this.text}}class y extends w{constructor(e){super(e),this.name="",this._updateView()}_mount(e){super._mount(e);const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.02*i,h=this._createSvgElement("rect",{x:t+.05*s,y:n+.53*i,height:.15*i,width:.2*s},["speaker-box"]);h.style.setProperty("--strokeWidth",o+"",""),this.element.appendChild(h);const d=this._createSvgElement("text",{x:t+.07*s,y:n+.63*i},["speaker-box__text"]),a=document.createTextNode("");d.appendChild(a),this.element.appendChild(d);this.element.querySelector(".textbox__text").setAttributeNS(null,"y",n+.78*i+"")}_updateView(){super._updateView();this.element.querySelector(".speaker-box").style.setProperty("--hue",this._hue+"","");const e=this.element.querySelector(".speaker-box__text");e.style.setProperty("--fontFamily",this.style+"",""),e.textContent=this.name}}class v extends y{constructor(e){super(e),this.name="???",this.style=s,this._hue=42,this._updateView()}_mount(e){super._mount(e);const{x:t,y:n,h:i,w:s}=this._boundingBox,o=t+.1*s,h=t+.2*s,d=n+.2*i,a=n+.5*i,r=[o+","+(d+.05*i),o+.05*s+","+d,h-.05*s+","+d,h+","+(d+.05*i),o+","+(a-.05*i),o+.05*s+","+a,h-.05*s+","+a,h+","+(a-.05*i)].join(" "),l=this._createSvgElement("ellipse",{cx:t+.15*s,cy:n+.5*i,rx:.11*s,ry:.35*i},["speaker-avatar__background"]),_=this._createSvgElement("polyline",{points:r},["speaker-avatar__pic","speaker-avatar__pic--narrator"]);_.setAttributeNS(null,"stroke-linecap","round"),this.element.insertBefore(_,this.element.firstChild),this.element.insertBefore(l,this.element.firstChild)}_updateView(){super._updateView();this.element.querySelector(".speaker-avatar__pic--narrator").style.setProperty("--hue",this._hue+"","")}}class b extends h{static worldName="base";constructor(e){super(e),this.melody=[],this._isActive=!1,this._updateView()}addScene(){this._addBackground(),this._addMiddleground(),this._addForeground()}isActive(){return this._isActive}playMusic(){if(this.melody.length>0){const e=262,t=new AudioContext,n=t.createGain();this.melody.forEach((i,s)=>{const o=t.createOscillator();i&&(o.connect(n).connect(t.destination),o.start(.1*s),o.frequency.setValueAtTime(e*1.06**(13-i),.1*s),n.gain.setValueAtTime(1,.1*s),n.gain.setTargetAtTime(1e-4,.1*s+.08,.005),o.stop(.1*s+.09))})}}setActive(){this._isActive=!0,this._updateView(),this.playMusic()}setInactive(){this._isActive=!1,this._updateView()}_addBackground(){}_addForeground(){}_addMiddleground(){}_mount(e){const t=["world","world--"+this.constructor.worldName];this.element=this._createSvgElement("g",{},t),e.appendChild(this.element)}_rollDice(e=1,t=6){return Math.floor(Math.random()*(t-e+e)+e)}_updateView(){super._updateView(),this.isActive()?this.element.classList.remove("hidden"):this.element.classList.add("hidden")}}class E extends b{static worldName="intro";constructor(e){super(e)}addScene(){this._addForeground(),this._showIntro()}_addForeground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+.05*i,y:t+.4*n,height:.45*n,width:.9*i},eventNode:this._eventNode,parent:this.element};this._narrator=new v(s)}_showIntro(){this._narrator.showText(_("WELCOME"))}}class N extends h{constructor(e){super(e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}_getEventMap(){return{[e]:this.__handleGameTimeUpdate.bind(this)}}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.08*s,h=[t+.5*s+","+(n+o),t+s-o+","+(n+.4*i),t+.7*s+","+(n+i-o),t+.3*s+","+(n+i-o),t+o+","+(n+.4*i)].join(" ");this.element=this._createSvgElement("polygon",{points:h},["five-portal"]),this.element.style.setProperty("--strokeWidth",o+"",""),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"","")}__handleGameTimeUpdate(e){e.hour&&e.minute?(this._hue=(60*e.hour+e.minute)/1440*360,this._updateView()):console.warn("Invalid event",e)}}class B extends b{static worldName="five-portal";_addBackground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n,width:i},eventNode:this._eventNode,parent:this.element};new N(s)}}class C extends h{constructor(e){super(e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}_getEventMap(){return{[e]:this.__handleGameTimeUpdate.bind(this)}}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.08*s,h=[t+.5*s+","+(n+o),t+s-o+","+(n+.5*i),t+.5*s+","+(n+i-o),t+o+","+(n+.5*i)].join(" ");this.element=this._createSvgElement("polygon",{points:h},["four-portal"]),this.element.style.setProperty("--strokeWidth",o+"",""),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"","")}__handleGameTimeUpdate(e){e.hour&&e.minute?(this._hue=(60*e.hour+e.minute)/1440*360,this._updateView()):console.warn("Invalid event",e)}}class S extends b{static worldName="four-portal";_addBackground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n,width:i},eventNode:this._eventNode,parent:this.element};new C(s)}}class f extends h{constructor(e){super(e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}_getEventMap(){return{[e]:this.__handleGameTimeUpdate.bind(this)}}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.08*s,h=[t+.3*s+","+(n+o),t+.7*s+","+(n+o),t+s-o+","+(n+.5*i),t+.7*s+","+(n+i-o),t+.3*s+","+(n+i-o),t+o+","+(n+.5*i)].join(" ");this.element=this._createSvgElement("polygon",{points:h},["six-portal"]),this.element.style.setProperty("--strokeWidth",o+"",""),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"","")}__handleGameTimeUpdate(e){e.hour&&e.minute?(this._hue=(60*e.hour+e.minute)/1440*360,this._updateView()):console.warn("Invalid event",e)}}class T extends h{constructor(e){super(e),this._hue=0,this._life=100,this._sympathy=0,this._updateView()}_getEventMap(){return{[e]:this.__handleGameTimeUpdate.bind(this)}}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.08*s,h=[t+.5*s+","+(n+o),t+s-o+","+(n+i-o),t+o+","+(n+i-o)].join(" ");this.element=this._createSvgElement("polygon",{points:h},["three-portal"]),this.element.style.setProperty("--strokeWidth",o+"",""),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"","")}__handleGameTimeUpdate(e){e.hour&&e.minute?(this._hue=(60*e.hour+e.minute)/1440*360,this._updateView()):console.warn("Invalid event",e)}}class k extends b{static worldName="portal";constructor(e){super(e),this._portalLength=.3}_addBackground(){this._portalLength=.3,this._addThreePortal(),this._addFourPortal(),this._addFivePortal(),this._addSixPortal()}_addFivePortal(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+i*(1-this._portalLength),y:t+n*(.5-this._portalLength/2),height:n*this._portalLength,width:i*this._portalLength},eventNode:this._eventNode,parent:this.element};new N(s)}_addFourPortal(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t+n*(.5-this._portalLength/2),height:n*this._portalLength,width:i*this._portalLength},eventNode:this._eventNode,parent:this.element};new C(s)}_addSixPortal(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+i*(.5-this._portalLength/2),y:t+n*(1-this._portalLength),height:n*this._portalLength,width:i*this._portalLength},eventNode:this._eventNode,parent:this.element};new f(s)}_addThreePortal(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+i*(.5-this._portalLength/2),y:t,height:n*this._portalLength,width:i*this._portalLength},eventNode:this._eventNode,parent:this.element};new T(s)}_getEventMap(){return{click:this._handleClick.bind(this)}}_handleClick(e){const t=e.getAttribute("class");if(console.log("Clicked world",e,t),!t||t&&!t.includes("-portal"))return;const n=new CustomEvent(i,{detail:{nextWorld:t}});this._eventNode.dispatchEvent(n)}}class V extends b{static worldName="six-portal";_addBackground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n,width:i},eventNode:this._eventNode,parent:this.element};new f(s)}}class M extends b{static worldName="three-portal";_addBackground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n,width:i},eventNode:this._eventNode,parent:this.element};new T(s)}}class G extends h{_mount(e){this.element=this._createSvgElement("g",{},["guild"]),e.appendChild(this.element),this._mountMarket()}_mountMarket(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=e+i,o=t+n,h=[e+","+o,e+","+(t+.1*n),e+.5*i+","+t,s+","+(t+.1*n),s+","+o].join(" "),d=this._createSvgElement("polygon",{points:h},["market"]);this.element.appendChild(d)}}class A extends h{constructor(e){super(e),this._radius=3,this._axisX=this._boundingBox.x,this._axisY=this._boundingBox.y}_getElementAttributes(){return this._radius=this._radius||3,this._axisX=this._axisX||this._boundingBox.x,this._axisY=this._axisY||this._boundingBox.y,{r:this._radius,cx:this._axisX,cy:this._axisY}}_getEventMap(){return{[e]:this._handleGameTimeUpdate.bind(this)}}_handleGameTimeUpdate(e){const{hour:t,minute:n}=e;if(!t||!n)return void console.warn("Invalid event",e);const{x:i,y:s,h:o,w:h}=this._boundingBox;let d=-5;t>=6&&t<=18&&(d=h*(60*(t-6)+n)/720);const a=60*(t+6)+n,r=this._radius+o+o*Math.sin(a*Math.PI/720);this._axisX=d,this._axisY=r,this._updateView()}_mount(e){const{r:t,cx:n,cy:i}=this._getElementAttributes();this.element=this._createSvgElement("circle",{r:t+"",cx:n-3*t+"",cy:i-3*t+""},["sun"]),e.appendChild(this.element)}_updateView(){super._updateView();const e=this._axisX,t=this._axisY;this.element.setAttributeNS(null,"cx",e+""),this.element.setAttributeNS(null,"cy",t+"")}}class L extends b{static worldName="five-town";constructor(e){super(e),this.melody=[1,,,,1,1,,,,,1,,,,1,1]}addScene(){this._addBackground(),this._addSun(),this._addMiddleground(),this._addForeground(),this._addGuild()}_addBackground(){}_addForeground(){}_addGuild(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+.3*i,y:t+.2*n,height:.6*n,width:.4*i},eventNode:this._eventNode,parent:this.element};new G(s)}_addMiddleground(){}_addSun(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n/3,width:i},eventNode:this._eventNode,parent:this.element};new A(s)}}class W extends h{constructor(e){super(e),this._hue=211,this._saturation=70,this._luminance=50,this._timeoutHandle=null,this._updateView()}_getEventMap(){return{[e]:this._handleGameTimeUpdate.bind(this)}}_handleGameTimeUpdate(e){const t=e.hour>5&&e.hour<8;e.hour>17&&e.hour<20&&(this._luminance-=.1),t&&(this._luminance+=.1),this._updateView()}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox;this.element=this._createSvgElement("rect",{x:t,y:n,height:i,width:s},["background"]),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")}}class P extends h{constructor(e){super(e),this._hue=140,this._life=50,this._luminance=50,this._timeoutHandle=null,this._updateView()}_getEventMap(){return{[e]:this._handleGameTimeUpdate.bind(this)}}_handleGameTimeUpdate(e){const t=e.hour>5&&e.hour<8;e.hour>17&&e.hour<20&&(this._luminance-=.1),t&&(this._luminance+=.1),this._updateView()}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox;this.element=this._createSvgElement("rect",{x:t,y:n,height:i,width:s},["foreground"]),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")}}class I extends h{constructor(e){super(e),this._hue=140,this._life=50,this._luminance=30,this._timeoutHandle=null,this._updateView()}_getEventMap(){return{[e]:this._handleGameTimeUpdate.bind(this)}}_handleGameTimeUpdate(e){const t=e.hour>5&&e.hour<8;e.hour>17&&e.hour<20&&(this._luminance-=.1),t&&(this._luminance+=.1),this._updateView()}_mount(e){const{x:t,y:n,h:i,w:s}=this._boundingBox;this.element=this._createSvgElement("rect",{x:t,y:n,height:i,width:s},["middleground"]),e.appendChild(this.element)}_updateView(){super._updateView(),this.element.style.setProperty("--hue",this._hue+"",""),this.element.style.setProperty("--luminance",this._luminance+"%","")}}class U extends h{_mount(e){this.element=this._createSvgElement("g",{},["castle"]),e.appendChild(this.element),this._mountLeftTower(),this._mountMain(),this._mountCrenellations(4),this._mountRightTower()}_mountCrenellations(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,o=.7*s/(2*e+1),h=t+.15*s,d=n+.1*i,a=n+.2*i,r=[h+","+a];for(let t=1;t<2*e;t+=2){const e=h+(t+1)*o;r.push(h+t*o+","+a),r.push(h+t*o+","+d),r.push(e+","+d),r.push(e+","+a)}const l=this._createSvgElement("polygon",{points:r.join(" ")},["crenellations"]);this.element.appendChild(l)}_mountLeftTower(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=e+.15*i,o=t+n,h=[e+","+o,e+","+t,s+","+t,s+","+o].join(" "),d=this._createSvgElement("polygon",{points:h},["tower"]);this.element.appendChild(d)}_mountMain(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=e+.15*i,o=e+i-.15*i,h=t+.2*n,d=t+n,a=[s+","+d,s+","+h,o+","+h,o+","+d].join(" "),r=this._createSvgElement("polygon",{points:a},[]);this.element.appendChild(r)}_mountRightTower(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=e+i-.15*i,o=e+i,h=t+n,d=[s+","+h,s+","+t,o+","+t,o+","+h].join(" "),a=this._createSvgElement("polygon",{points:d},["tower"]);this.element.appendChild(a)}}class H extends y{constructor(e){super(e),this.name="Leonhard",this.style=o,this._hue=80,this._updateView()}_mount(e){super._mount(e);const{x:t,y:n,h:i,w:s}=this._boundingBox,o=t+.1*s,h=t+.2*s,d=n+.2*i,a=n+.7*i,r=[o+","+a,o+.02*s+","+d,h-.02*s+","+d,h+","+a].join(" "),l=this._createSvgElement("polyline",{points:r},["speaker-avatar__pic","speaker-avatar__pic--knight"]);this.element.insertBefore(l,this.element.firstChild)}_updateView(){super._updateView();this.element.querySelector(".speaker-avatar__pic--knight").style.setProperty("--hue",this._hue+"","")}}class j extends h{constructor(e){super(e);const{x:t,y:n,h:i,w:s}=this._boundingBox;this._windStrength="still",this._axisX=t+.5*s,this._axisY=n+.3*i,this.degree=0,this._updateView()}_getElementAttributes(){const{x:e,y:t,h:n,w:i}=this._boundingBox;return this._axisX=this._axisX||e+.5*i,this._axisY=this._axisY||t+.5*n,this._degree=this._degree||0,{axisX:this._axisX,axisY:this._axisY,degree:this._degree}}_getEventMap(){return{[e]:this._handleGameTimeUpdate.bind(this),[n]:this._handleWorldWeatherWind.bind(this)}}_handleGameTimeUpdate(e){if(!e.hour||!e.minute)return void console.warn("Invalid event",e);let t=1.5;"medium"===this._windStrength&&(t=6),"strong"===this._windStrength&&(t=9),this._degree=e.minute*t,this._updateView()}_handleWorldWeatherWind(e){this._windStrength=e.wind,this._updateView()}_mount(e){this.element=this._createSvgElement("g",{},["mill"]),e.appendChild(this.element),this._mountBuilding(),this._mountWings()}_mountBuilding(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=e+.3*i,o=e+.7*i,h=t+.3*n,d=t+n,a=[s+","+d,s+.1*i+","+h,o-.1*i+","+h,o+","+d].join(" "),r=this._createSvgElement("polygon",{points:a},[]);this.element.appendChild(r)}_mountWings(){const e=this._createSvgElement("g",{},["wings"]);this._mountTopWing(e),this._mountRightWing(e),this._mountBottomWing(e),this._mountLeftWing(e),this.element.appendChild(e)}_mountBottomWing(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,{axisX:o,axisY:h}=this._getElementAttributes(),d=o-.01*s,a=o+.01*s,r=h+.01*i,l=h+.3*i,_=l-.2*i,u=[a+","+r,a+","+l,d+","+l,d+","+_,a-.02*s+","+_,a-.02*s+","+r].join(" "),c=this._createSvgElement("polygon",{points:u},["bottom","wing"]);e.appendChild(c)}_mountLeftWing(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,{axisX:o,axisY:h}=this._getElementAttributes(),d=o-.3*s,a=o-.01*s,r=h-.1*i,l=h+.01*i,_=d+.2*s,u=[a+","+l,d+","+l,d+","+r,_+","+r,_+","+(l-.02*i),a+","+(l-.02*i)].join(" "),c=this._createSvgElement("polygon",{points:u},["left","wing"]);e.appendChild(c)}_mountRightWing(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,{axisX:o,axisY:h}=this._getElementAttributes(),d=o+.01*s,a=o+.3*s,r=h-.01*i,l=h+.1*i,_=a-.2*s,u=[d+","+r,a+","+r,a+","+l,_+","+l,_+","+(r+.02*i),d+","+(r+.02*i)].join(" "),c=this._createSvgElement("polygon",{points:u},["right","wing"]);e.appendChild(c)}_mountTopWing(e){const{x:t,y:n,h:i,w:s}=this._boundingBox,{axisX:o,axisY:h}=this._getElementAttributes(),d=o-.01*s,a=o+.1*s,r=h+.3*i,l=h-.01*i,_=r+.2*i,u=[d+","+l,d+","+r,a+","+r,a+","+_,d+.02*s+","+_,d+.02*s+","+l].join(" "),c=this._createSvgElement("polygon",{points:u},["top","wing"]);e.appendChild(c)}_updateView(){super._updateView();const e=`rotate(${this._degree},${this._axisX+","+this._axisY})`;this.element.querySelector(".wings").setAttributeNS(null,"transform",e)}}class Y extends b{static worldName="four-castle";constructor(e){super(e),this.__windChangeHandle=null}addScene(){this._addBackground(),this.__addSun(),this._addMiddleground(),this.__addMill(),this.__addCastle(),this._addForeground(),this.__addKnight(),this.fireWindChange();this.__windChangeHandle=setInterval(this.fireWindChange.bind(this),4e3)}fireWindChange(){const e=this._rollDice(),t=new CustomEvent(n,{detail:{wind:[null,"still","still","medium","medium","medium","strong"][e]}});this._eventNode.dispatchEvent(t)}_addBackground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n/3,width:i},eventNode:this._eventNode,parent:this.element};new W(s)}_addForeground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+n/3+n/5,o={boundingBox:{x:e,y:s,height:n-s,width:i},eventNode:this._eventNode,parent:this.element};new P(o)}_addMiddleground(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:n/3,height:n/5,width:i},eventNode:this._eventNode,parent:this.element};new I(s)}__addCastle(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+15,y:t+.4*n,height:n/4,width:e+.75*i-30},eventNode:this._eventNode,parent:this.element};new U(s)}__addKnight(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+.05*i,y:t+.4*n,height:.45*n,width:.9*i},eventNode:this._eventNode,parent:this.element};new H(s)}__addMill(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+.7*i,y:t+.3*n,height:.2*n,width:.2*i},eventNode:this._eventNode,parent:this.element};new j(s)}__addSun(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n/3,width:i},eventNode:this._eventNode,parent:this.element};new A(s)}}class F extends b{static worldName="six-mountain";constructor(e){super(e)}addScene(){this._addBackground(),this._addSun(),this._addMiddleground(),this._addForeground()}_addBackground(){}_addForeground(){}_addMiddleground(){}_addSun(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n/3,width:i},eventNode:this._eventNode,parent:this.element};new A(s)}}class O extends h{_mount(e){this.element=this._createSvgElement("g",{},["hut"]),e.appendChild(this.element),this._mountRoof(),this._mountBuilding()}_mountBuilding(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+.8*n,o=[e+.05*i+","+s,e+.5*i+","+t,e+.95*i+","+s].join(" "),h=this._createSvgElement("polygon",{points:o},[]);this.element.appendChild(h)}_mountRoof(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+.6*n,o=[e+","+s,e+.5*i+","+t,e+i+","+s].join(" "),h=this._createSvgElement("polygon",{points:o},[]);this.element.appendChild(h)}}class R extends h{constructor(e){super(e),this._updateView()}_mount(e){this.element=this._createSvgElement("g",{},["sea"]),e.appendChild(this.element),this._mountSky(),this._mountWaves()}_mountFilter(){this._filterId="sea-filter";let e=document.querySelector("#"+this._filterId);if(null!==e)return;e=this._createSvgElement("filter",{id:this._filterId},[]);const t=this._createSvgElement("feTurbulence",{id:"turbulence",type:"turbulence",baseFrequency:"0.042",numOctaves:"1",result:"turbulence",seed:5},[]),n=this._createSvgElement("animate",{id:"animate",attributeName:"baseFrequency",values:"0;0.1;0;0",from:"0",to:"100",dur:"10s",repeatCount:"inifinte"},[]),i=this._createSvgElement("feDisplacementMap",{in:"SourceGraphic",in2:"turbulence",scale:"30",xChannelSelector:"R",yChannelSelector:"R"},[]);e.appendChild(t),e.appendChild(n),this.element.appendChild(e),this.element.appendChild(i)}_mountSky(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=e+i,o=[e+","+t,s+","+t,s+","+(t+.5*n)].join(" "),h=this._createSvgElement("polygon",{points:o},["sky"]);this.element.appendChild(h)}_mountWaves(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s=t+n,o=e+i,h=[o+","+(t+.5*n),o+","+s,e+","+s].join(" "),d=this._createSvgElement("polygon",{points:h},["waves"]);this.element.appendChild(d)}}class q extends b{static worldName="three-village";constructor(e){super(e),this.melody=[13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13,,,,13,,,13,,,13,,13,13]}addScene(){this._addBackground(),this.__addSun(),this.__addSea(),this._addMiddleground(),this._addForeground(),this.__addHut()}_addBackground(){}_addForeground(){}_addMiddleground(){}__addHut(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e+15,y:t+.7*n,height:t+.25*n,width:i-30},eventNode:this._eventNode,parent:this.element};new O(s)}__addSea(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n/3,width:i},eventNode:this._eventNode,parent:this.element};new R(s)}__addSun(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n/3,width:i},eventNode:this._eventNode,parent:this.element};new A(s)}}
/**
   * @file
   * Let me take the chance to share a bit about the history of this game.
   * When reading the source code, you might wonder, why there are 3- elements
   * and worlds. Well, I started developing this code during vacation.
   * I had next to no internet connection and English isn't my first language.
   * So I picked a naming convention, that made sense.
   * In the beginning, the class names started with digits as well.
   * However, I couldn't target those with CSS for some reason, so I changed
   * them to their long form.
   *
   * I normally have a single place, where all other moving parts are started.
   * This is this file, game.js.
   * It sets up the basic structure and initialises the game logic.
   *
   * During those two weeks of vacation, I realised, that there is quite some
   * duplicated logic. But I couldn't look up the
   * {@link https://javascript.info/mixins|Mixin Pattern}, so I went with
   * what I knew by heart: class inheritance
   * If you look below, you can see, that there are almost all classes
   * inheriting from WithParent.
   * For the GameClass, I couldn't do that, since that would end up in a
   * recursion. Here, a mixin would have been helpful.
   *
   * I said to myself, that I could adjust it once I transfer the code back to
   * my laptop. But then work happened. And life caught me. So sad …
   *
   * @author André Jaenisch
   * @license GPL v3 or newer
   *
   * @mermaid
   *   classDiagram
   *     class Game
   *     BaseWorld         <|-- FivePortalWorld
   *     BaseWorld         <|-- FiveTownWorld
   *     BaseWorld         <|-- FourCastleWorld
   *     BaseWorld         <|-- FourPortalWorld
   *     BaseWorld         <|-- IntroWorld
   *     BaseWorld         <|-- PortalWorld
   *     BaseWorld         <|-- SixMountainWorld
   *     BaseWorld         <|-- SixPortalWorld
   *     BaseWorld         <|-- ThreePortalWorld
   *     BaseWorld         <|-- ThreeVillageWorld
   *     BaseWorld         <|-- TitleWorld
   *     Person            <|-- Fisherwoman
   *     Person            <|-- Knight
   *     Person            <|-- Narrator
   *     Person            <|-- Pilot
   *     Person            <|-- Scribe
   *     Tab               <|-- TabDebug
   *     Tab               <|-- TabInventory
   *     Tab               <|-- TabMemory
   *     Tab               <|-- TabSettings
   *     TextBox           <|-- Person
   *     WithBoundingBox   <|-- WithEventListener
   *     WithEventListener <|-- WithLife
   *     WithLife          <|-- WithSympathy
   *     WithParent        <|-- BaseWorld
   *     WithParent        <|-- Background
   *     WithParent        <|-- Canvas
   *     WithParent        <|-- Castle
   *     WithParent        <|-- Controls
   *     WithParent        <|-- FivePortal
   *     WithParent        <|-- Foreground
   *     WithParent        <|-- FourPortal
   *     WithParent        <|-- Guild
   *     WithParent        <|-- Hut
   *     WithParent        <|-- Middleground
   *     WithParent        <|-- Mill
   *     WithParent        <|-- Navigation
   *     WithParent        <|-- Sea
   *     WithParent        <|-- SixPortal
   *     WithParent        <|-- Sun
   *     WithParent        <|-- Tab
   *     WithParent        <|-- TextBox
   *     WithParent        <|-- ThreePortal
   *     WithParent        <|-- Time
   *     WithSympathy      <|-- WithParent
   *
   *     WithBoundingBox   : Object _boundingBox
   *     WithEventListener : HTMLElement _eventNode
   *     WithEventListener : _getEventMap() Object
   *     WithEventListener : _handleEvent(event)
   *     WithLife          : Number _life
   *     WithLife          : _updateView()
   *     WithParent        : _createHtmlElement (String name, Object attributes, Array classes): HTMLElement
   *     WithParent        : _createSvgElement (String name, Object attributes, Array classes): SVGElement
   *     WithParent        : _mount(HTMLElement)*
   *     WithSympathy      : Number _sympathy
   *     WithSympathy      : _mapSympathyToLuminance() : Number
   */const X=document.querySelector("#app"),D=new class{constructor(e){this.clock={minute:0,hour:5,day:1},this._boundingBox={x:0,y:0,h:100,w:100},this._eventNode=e,this._parent=e,this.__timeHandle=null,this.__worlds=[],Object.keys(this._getEventMap()).forEach(e=>{this._eventNode.addEventListener(e,this,!1)}),this._mount(e)}addWorlds(){const{x:e,y:t,h:n,w:i}=this._boundingBox,s={boundingBox:{x:e,y:t,height:n,width:i},eventNode:this._eventNode,parent:this.canvas.element};[{ctr:E,left:k.worldName,right:k.worldName,top:k.worldName},{ctr:k,left:k.worldName,right:k.worldName,top:k.worldName},{ctr:M,left:q.worldName,right:q.worldName,top:k.worldName},{ctr:q,left:M.worldName,right:M.worldName,top:q.worldName},{ctr:S,left:Y.worldName,right:Y.worldName,top:k.worldName},{ctr:Y,left:S.worldName,right:S.worldName,top:Y.worldName},{ctr:B,left:L.worldName,right:L.worldName,top:B.worldName},{ctr:L,left:B.worldName,right:B.worldName,top:L.worldName},{ctr:V,left:F.worldName,right:F.worldName,top:V.worldName},{ctr:F,left:V.worldName,right:V.worldName,top:F.worldName}].forEach(e=>{const t=new e.ctr(s);this.__worlds.push({instance:t,name:e.ctr.worldName,left:e.left,right:e.right,top:e.top}),t.addScene()})}fireNewTime(){this.clock.minute+=1,this.clock.minute>=60&&(this.clock.hour+=1,this.clock.minute-=60),this.clock.hour>=24&&(this.clock.day+=1,this.clock.hour-=24);const t=new CustomEvent(e,{detail:this.clock});this._eventNode.dispatchEvent(t)}getCurrentWorld(){return this.__worlds.find(e=>e.instance.isActive())}handleEvent(e){const{detail:t,isTrusted:n,target:i,type:s}=e,o=this._getEventMap()[s];if(o)return n&&i?void o(i):!n&&t?void o(t):(console.warn("Unknown event type "+s),void o(e));console.warn("No callback for "+e.type)}init(){const e=E.worldName;this.addWorlds(),this.__addTime(),this.__addControls(),this.switchWorld({nextWorld:e})}pauseTime(){clearInterval(this.__timeHandle)}startTime(){this.__timeHandle=setInterval(this.fireNewTime.bind(this),33)}switchWorld({nextWorld:e}){const t=this.__worlds.find(t=>t.name==e);this.__worlds.forEach(e=>e.instance.setInactive()),console.log("Transitioning to ",e,t),t&&t.instance.setActive()}_getEventMap(){return{[t]:this.__handleGameControlsTurn.bind(this),[i]:this.switchWorld.bind(this)}}_mount(e){const t={boundingBox:{x:0,y:0,height:100,width:100},parent:this._parent,eventNode:this._eventNode};this.navigation=new x(t),this.canvas=new d(t)}__addControls(){const e={boundingBox:{x:this._boundingBox.x+this._boundingBox.w-15,y:this._boundingBox.y+this._boundingBox.h-10,height:10,width:15},eventNode:this._eventNode,parent:this.canvas.element};new a(e)}__addTime(){const{h:e,w:t}=this._boundingBox,n={boundingBox:{x:.8*e,y:.95*t},eventNode:this._eventNode,parent:this.canvas.element};new r(n)}__handleGameControlsTurn(e){const t=this.getCurrentWorld()[e.direction];this.switchWorld({nextWorld:t})}}(X);D.init();let $=!0;document.getElementById("action").addEventListener("click",()=>{$?D.startTime():D.pauseTime(),$=!$},!1)}();
</script>

</body></html>